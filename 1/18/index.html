<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.93.3">
<meta name=description content>
<link rel=icon href=/images/favicon.png type=image/png>
<title>18_为什么这些SQL语句逻辑相同，性能却差异巨大？ :: Gen 的学习笔记</title><link href=/css/nucleus.css?1646789669 rel=stylesheet>
<link href=/css/fontawesome-all.min.css?1646789669 rel=stylesheet>
<link href=/css/hybrid.css?1646789669 rel=stylesheet>
<link href=/css/featherlight.min.css?1646789669 rel=stylesheet>
<link href=/css/perfect-scrollbar.min.css?1646789669 rel=stylesheet>
<link href=/css/auto-complete.css?1646789669 rel=stylesheet>
<link href=/css/atom-one-dark-reasonable.css?1646789669 rel=stylesheet>
<link href=/css/theme.css?1646789669 rel=stylesheet>
<link href=/css/tabs.css?1646789669 rel=stylesheet>
<link href=/css/hugo-theme.css?1646789669 rel=stylesheet>
<link href=/css/theme-green.css?1646789669 rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js?1646789669></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/1/18/>
<nav id=sidebar>
<div id=header-wrapper>
<div id=header>
<a id=logo href=/><svg id="grav-logo" style="width:100%;height:100%" viewBox="0 0 504 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421"><path id="path189" style="fill:#000;stroke-width:.204716" d="m82.052734 5.96875c-.854728.206286-1.398833 1.0426648-2.119991 1.5136522-1.191736.9811717-2.382712 1.9632671-3.575321 2.9433788 2.594183.350428 5.145702.867699 7.545412 1.808313 5.15394 2.088262 10.087847 4.726839 15.416602 6.374822 1.147804.40744 2.285264.842546 3.422754 1.277803 1.75942-1.384373 3.51938-2.768062 5.27734-4.154297-5.15508-1.970902-10.472419-3.533913-15.466989-5.9135627-3.304489-1.4459104-6.569291-3.1504213-10.136525-3.8383905-.121039-.00522-.24197-.024031-.363282-.011719z"/><path id="path450" style="fill:#000;stroke-width:.204716" d="m196.30273 32.138672c-1.55372 1.106817-3.11032 2.209608-4.66406 3.316406 4.11763 4.405283 7.13993 9.726972 9.45954 15.262663 1.56282 4.287959 2.2182 8.808703 2.86451 13.292499.38887 3.231143.62551 6.590222.0466 9.712715-.96049 4.643178-2.51468 9.199787-4.84902 13.336481-1.78789 2.835013-4.77216 5.01731-8.11326 5.529767-2.16053.194334-4.25815-1.330295-4.80458-3.419166-.29054-.914485-.51906-1.850946-.67999-2.79699 2.1261-1.148168 4.25191-2.296867 6.37891-3.443359.78567-2.636208 1.75001-5.564844.60547-8.248047-.53525-1.298746-2.07776-1.892115-3.39901-1.607978-1.67519.02941-3.3829.406643-4.74129 1.430853-2.09614 1.168313-4.10099 2.916619-4.64291 5.358765-.73735 2.904669-.11138 5.915639.29727 8.820042.49411 2.882218 1.53935 5.996824 4.13517 7.643151 2.35305 1.561098 5.48511 1.763546 8.04109.579307 3.30354-1.331591 6.21912-3.456703 8.96703-5.688008 1.96663-1.643363 3.42478-3.806368 4.42597-6.15213 2.06828-4.393527 3.59057-9.083525 4.21247-13.907794.54472-5.741127-.61574-11.455157-1.66588-17.071718-.80064-3.920321-2.18078-7.71884-4.16423-11.197019-2.05596-3.912809-4.48616-7.631847-7.30162-11.041456-.13607.097-.27214.194011-.40821.291016zm-8.92578 46.195312c.2043 1.815935-.60122 3.548925-1.07929 5.263081-.26336.819832-.52694 1.639598-.78985 2.459576-.30945-2.140868-.59564-4.349894-.22997-6.496983.18103-.524926.30215-1.38075 1.03046-1.299978.29126.03359 1.0366-.341949 1.06865.0743z"/><path id="path452" style="fill:#000;stroke-width:.204716" d="m194.86719 31.490234c-1.70711 1.334537-3.41328 2.670271-5.1211 4.003907 2.86943.883205 5.775 2.063806 7.95683 4.093286 4.34216 3.834897 7.82362 8.740548 9.94201 14.191942 1.76448 4.476901 2.8312 9.131581 3.98461 13.784118.98733 4.367667 1.90544 8.806141 3.88594 12.856576 1.24292 2.622586 2.70301 5.245971 5.0027 7.092602 2.86039 2.399492 6.23621 4.055842 9.38886 6.021597 2.04982 1.173006 4.12056 2.42864 6.39784 3.079398 1.45651.10626 2.44267-1.215991 3.58737-1.828292.94383-.603205 1.48969-1.756053 1.1938-2.859996-.26262-3.334359-1.79835-6.420037-2.55184-9.603237-1.082-3.641846-2.12776-7.319367-2.61203-11.103361-1.00164-5.999038-1.25683-12.026556-1.07049-18.099458.15781-3.468309.76516-7.086829 1.79952-10.394254.64699-1.974316 1.63337-3.824169 2.48746-5.7485 1.81963 1.486138 2.86594 3.671816 3.9004 5.728955.64108 1.500012.97375 3.161278.76757 4.790577-.65333-.253181-1.39605-.122429-1.84271.440021-1.42475 1.127514-2.85059 2.25365-4.27448 3.382244 1.88905.912209 4.07218 1.774111 6.16993 1.046875 1.41721-.500184 2.61209-1.460186 3.82031-2.322265 1.61109-1.433166 2.12717-3.722659 1.84286-5.796283-.25541-3.407249-2.01838-6.471843-3.90241-9.234739-1.20503-1.564932-2.69095-3.179269-4.68989-3.629264-2.29359-.240154-4.23277 1.369272-5.7447 2.892708-1.43661 2.020458-2.19043 4.395461-3.26252 6.599693-1.49815 3.623296-2.20417 7.528274-2.57907 11.414395-.28341 3.951365-.19329 7.924341.002 11.877608.33001 4.919807.95661 9.833736 2.05577 14.642753.86678 3.567725 1.99782 7.062219 3.05361 10.576879-3.15033-1.782655-6.31477-3.575686-9.24095-5.712379-2.79226-2.230651-4.33102-5.569215-5.59547-8.821527-1.43467-3.856976-2.08138-7.93959-3.1517-11.901307-1.2033-4.621024-2.39596-9.284022-4.32968-13.665113-2.65871-5.844039-6.70058-11.067953-11.71736-15.073502-1.61991-1.219808-3.40929-2.21157-5.31445-2.910157-.0794.0625-.15886.125-.23828.1875z"/><path id="path454" style="fill:#000;stroke-width:.204716" d="m254.32422 60.896484c-2.83006.191036-5.03358 2.200857-7.25961 3.693573-2.47583 1.745762-4.35875 4.322203-5.13274 7.262544-.87682 3.10457-.8925 6.386041-.66333 9.580213.28103 2.760325 1.40168 5.413874 3.21193 7.520311 1.70594 2.226415 3.96523 4.02624 6.58223 5.060539 1.96205.825143 4.24546 1.477142 6.30644.60157.53052-.223408-.579.488221-.79955.696267-3.55669 2.717013-6.96075 5.643309-10.03806 8.898339-3.00732 3.02489-5.58812 6.54712-7.09012 10.56555-1.52988 3.64022-2.18897 7.75831-1.16537 11.62585 1.1817 4.89934 4.89376 9.02479 9.55065 10.89607 3.31904 1.41685 6.8989 2.15208 10.47421 2.53862 1.33062.14817 2.74633-.0804 3.79142-.97127 1.26107-.73033 2.85276-1.49217 3.09455-3.10504.98221-4.40417.4144-8.94054.57187-13.40766.0559-9.78704-.13373-19.58303.15814-29.363921.22294-.322518.70593-.47792.98565-.786323 3.15772-2.482196 6.24325-5.094621 9.44181-7.481219.59962-.562387 1.37371-1.333493 1.12122-2.214688-.58838-1.019752-1.9005-.72381-2.80832-.393333-1.78507.665067-3.47142 1.597264-4.9082 2.856236-1.27226.954663-2.48458 2.004466-3.71388 2.992226.0582-1.808273-.2238-3.702052.46966-5.419967 1.29511-4.12273 1.38265-8.583115.37497-12.777365-.40543-2.092479-.5444-4.224875-.57901-6.349544-.12138-1.041696-1.27545-1.792292-2.25563-1.339589-.44131.07748-.73882.621708-1.12056.653678-2.66594-1.25476-5.64308-1.684906-8.56131-1.835573zm.33203 5.285157c2.01725.246306 4.08801.70676 5.74023 1.958984.49385-.198426.10745 1.069897.2356 1.480834.0141 5.004454.0397 10.022836-.26491 15.015164-.54725 1.610021-1.37948 3.119937-2.27537 4.560643-.29357.413619-.64502.972024-1.23854.753886-2.97677-.555212-5.7871-2.226129-7.55638-4.708964-1.73668-1.945495-2.4821-4.544038-2.47151-7.147851-.0102-2.492946.0306-4.99488.91085-7.343489.73261-1.875515 1.96563-3.730677 3.8265-4.614744 1.01134-.351459 2.06471-.0229 3.09353.04554zm5.48437 34.769529c-.0724 10.74931.0496 21.50087-.0827 32.24888-.0316.50518-.0784 1.00973-.14971 1.51089-3.6299-.36444-7.17132-1.2816-10.41387-2.97137-3.31505-1.88151-5.62981-5.38503-6.00686-9.18451-.34732-2.69647.25495-5.42026 1.34629-7.88372 1.31942-3.35117 3.42797-6.40619 5.95909-8.88755 2.88063-3.07638 6.02153-5.910197 9.37903-8.457618-.0104 1.208333-.0208 2.416667-.0313 3.624998z"/><path id="path456" style="fill:#000;stroke-width:.204716" d="m286.45117 62.744141c-.66276.0108-1.0893.579612-1.58984.919921-2.93216-.416883-6.1457-.03654-8.52713 1.859521-1.32775.839426-2.71795 1.775792-3.34291 3.285064-1.96619 3.59837-2.81372 7.799977-2.48463 11.879219.58618 4.391569 3.77417 8.360576 8.02068 9.714478 3.09823 1.057475 6.42957 1.208399 9.67383 1.054687 2.00132-.177732 3.83824-1.164999 5.41409-2.288612 1.93792-1.221245 3.80495-2.745567 4.75664-4.887712 1.27631-2.582436 2.06687-5.395576 2.51547-8.233505.29359-2.654253-1.0275-5.228394-2.7852-7.132573-2.12288-2.207611-4.88968-3.643737-7.64514-4.897051-1.24663-.488298-2.51233-.998051-3.82059-1.270293-.0615.0067-.12392-.01566-.18527-.0031zm-.76172 5.544921c1.33874.466153 2.72682 1.108914 3.99146 1.820734 2.3343 1.241606 4.77095 2.977239 5.44214 5.689032.34285 2.011522-.5266 3.97606-1.06266 5.878051-.57623 1.593021-1.21802 3.351886-2.6703 4.347853-1.85437.702929-3.8863.346015-5.81627.291151-2.9267-.216886-6.09721-1.13898-7.8626-3.659801-1.58319-2.125298-1.94862-4.931501-1.41712-7.483183.34601-2.202505.95334-4.411407 2.16488-6.305711 1.72955-.549238 3.55003-.159042 5.2991.01258.58196.0145 1.07248-.33425 1.44114-.750866.16341.05339.32682.106771.49023.160156z"/><path id="path458" style="fill:#000;stroke-width:.204716" d="m312.22656 63.080078c-2.51287-.06687-4.65817 1.475076-6.57812 2.91211-2.04617 1.597902-3.36366 3.956301-3.96106 6.457589-.69758 2.785863-.78555 5.72098-.38894 8.557054.45501 2.562579 1.62143 5.141346 3.83069 6.648159 2.22165 1.784303 4.86213 3.031589 7.67199 3.533149 3.55108.707794 7.20025.635324 10.80301.591013 2.16637-.158142 4.39539-.452498 6.36267-1.410011 2.07587-1.747288 3.95151-3.712247 5.70312-5.78125-2.79921.445598-5.49844 1.330936-8.26339 1.923705-3.39336.425307-6.83433.249648-10.23012-.04257-3.24745-.407049-6.52917-1.646109-8.82841-4.041056-.87222-1.044913-1.21587-2.282305-1.45637-3.562052-.26964-2.262109-.13957-4.588823.36966-6.808958.33731-1.374369.93104-2.721367 1.91644-3.756179 2.37937-.429241 4.84399.104078 7.07813.939453 1.11063.442475 2.11782 1.117109 2.96875 1.955078 1.69271-1.222252 3.38676-2.442646 5.08008-3.664062-2.66632-2.652709-6.35737-4.016762-10.05096-4.376845-.67268-.08546-1.35003-.09118-2.02717-.07433z"/><path id="path460" style="fill:#000;stroke-width:.204716" d="m286.07422 99.496094c-1.07934-.0024-1.82247.939246-2.52539 1.519526-.851.70779-1.76177 1.34363-2.75 1.84571.10409 1.4247 1.00637 2.71545 2.30403 3.3049 1.0993.9205 2.58927 1.76482 4.04753 1.17752 1.90839-.57603 3.60529-2.60159 3.03127-4.66604-.24239-1.55382-1.36304-3.209315-3.09377-3.187476-.33817.0088-.67622-.02649-1.01367.0059z"/><path id="path464" style="fill:#000;stroke-width:.204716" d="m371.67188 20.626953c-3.87604 1.944717-7.75613 3.888659-11.47852 6.119141 1.10416-.0044 2.20833-.0089 3.3125-.01172-2.12786 4.917471-2.2546 10.388689-2.12305 15.660156.35129 5.01355 2.02586 9.810998 3.70363 14.509646 1.38866 3.777132 2.7827 7.452227 3.66164 11.3659.85336 3.402855 1.29928 6.910206 1.308 10.447135.0802 4.183874.21652 8.436832-.61619 12.533292-.82952 4.256594-2.10342 8.496467-4.44794 12.181686-1.27591 2.17814-2.95847 4.09056-4.92893 5.66614-1.4947 1.30394-3.28466 2.42294-5.1431 2.96612-2.39632.75818-4.8139.92992-7.31504.96576-1.38398-.001-2.76732-.6657-3.42811-1.91942-1.17952-1.92247-1.43828-4.29667-1.23452-6.50088-.072-.59683.49407-.45599.8906-.49906.4488-.0105 1.13089-.11797 1.17301.51024.41153 1.70485.26658 3.48863.31896 5.23047 71e-5.68229.002 1.36459.003 2.04688 1.90405-1.12478 3.80883-2.24831 5.7129-3.37305-.13258-2.7825.25622-5.8613-1.42774-8.28125-.9124-1.199373-2.54906-1.368673-3.94062-1.215946-1.58257-.05091-3.231.243516-4.50269 1.241586-2.01363 1.04845-3.69566 2.97113-3.89001 5.30511-.35901 2.56593.15031 5.20715 1.10217 7.59326 1.08182 2.48207 3.33319 4.66552 6.14699 4.84641 2.41571.25391 4.83773-.17138 7.23065-.45987 3.43975-.6249 6.46732-2.49346 9.27287-4.49033 3.70335-2.48113 7.17849-5.51773 9.32948-9.48525 2.76734-4.614072 4.23626-9.901741 4.96799-15.199902.5525-4.277499.36306-8.601147.27024-12.900272-.10538-3.360412-.59916-6.701988-1.5034-9.941147-1.01323-4.310005-2.61015-8.445066-4.11035-12.599558-1.15953-3.383432-2.2477-6.765931-2.76717-10.283458-.33024-3.191741-.23107-6.55122.089-9.779123.36915-3.275313 1.43804-6.518457 3.45986-9.153927.90985-1.339577 1.8197-2.679149 2.72974-4.018598-.60873.307943-1.21745.615885-1.82617.923828z"/><path id="path466" style="fill:#000;stroke-width:.204716" d="m378.41211 36.992188c-2.95498.280324-5.86099.959554-8.72191 1.726685-3.48706 1.125695-6.68165 3.068917-9.47059 5.423031-2.56647 2.52845-3.92486 5.941757-5.55982 9.083275-.82608 1.721803-1.65239 3.443491-2.47815 5.165446 2.4334-1.275762 4.86732-2.550527 7.30078-3.826172 1.48474-3.078592 2.82421-6.267576 5.04492-8.919922.37009-.484192 1.06101-.352533 1.4769-.805542.96403-.824462 2.26732-1.015047 3.43718-1.415431 2.16001-.556031 4.36494-1.020535 6.56444-1.321996 1.63608-.05267 2.81813 1.277896 3.61272 2.548816 1.61011 2.517063 2.53967 5.509476 2.17683 8.471365-.15926.806383-.30463 1.757669-.91027 2.335911-1.23529.812349-2.5271 1.570455-3.64881 2.53258-1.05465 1.010852-1.29014 2.99378.005 3.90959 1.10397.771221 2.48005.146732 3.46359-.520192 1.29018-.710688 2.43727-1.673469 3.63473-2.496494 3.70686-.791836 7.53625-.861897 11.30656-.662435 1.77784.291901 3.18039 1.611104 4.02392 3.142913 2.57898 3.825958 4.24413 8.148004 4.98248 12.705642.67022 3.616411 1.12179 7.379282.74216 11.014872-.34106 1.748258-.84725 3.691605-1.96926 5.175636-.96893.649595-2.1745.835524-3.28802 1.122337-2.6009.548228-5.39227.396336-7.7976-.803806-2.77349-1.192048-5.22531-3.0329-7.28016-5.233016-.3945-.779099-.90346-.07995-1.38135.226711-1.35242.977451-2.70594 1.953363-4.05756 2.931914 2.24054 2.398724 4.74359 4.601413 7.68825 6.093768 3.25183 1.841965 7.13161 2.665009 10.82624 1.922007 3.6294-.612513 7.11555-2.286566 9.77115-4.844758 1.96335-2.122487 2.68295-5.045637 3.19814-7.807952.3987-5.091629-.44666-10.18885-1.56074-15.141305-1.05935-4.233613-3.02767-8.207304-5.51137-11.780005-1.25317-1.797572-3.09833-3.242237-5.29091-3.639442-2.34828-.50242-4.76173-.155362-7.13833-.149969-1.48293.0791-2.96525.208398-4.43164.447266 1.1072-4.302368-.25828-8.87208-2.60303-12.520248-1.37932-2.074659-3.51292-4.084833-6.15674-4.09108z"/><path id="path468" style="fill:#000;stroke-width:.204716" d="m423.28906 62.134766c-1.63995.97054-3.28033 1.94036-4.92187 2.908203-.005 4.860224-.0554 9.74159.63518 14.564078.26451 3.642161-.0516 7.367269.98576 10.916826.42202 1.528949.57544 3.428854 2.02945 4.374565 1.67804 1.119853 3.85376.452608 5.42395-.533389 2.15482-1.410381 4.32474-2.885565 5.95208-4.915798 1.06489-1.237277 1.93975-2.619085 2.8603-3.962923-2.69521.780684-5.50568 1.495949-7.83152 3.126296-.73545.615066-1.29977 1.758673-2.3345 1.799485-.65265-2.346208-1.1458-4.764948-1.22309-7.213103-.001-3.183751-.28693-6.355244-.63761-9.516081-.28356-3.960842-.13171-8.020399-.13344-12.024722-.26823.158854-.53646.317708-.80469.476563z"/><path id="path470" style="fill:#000;stroke-width:.204716" d="m421.32422 50.556641c-1.07185.409354-1.82089 1.344889-2.78081 1.947169-.73001.555316-1.46029 1.110263-2.18989 1.666112 1.19469.615669 2.29216 1.471247 3.61328 1.802734-.0189 1.007812-.038 2.015621-.0566 3.023438 1.91341-1.124993 3.82781-2.248329 5.74023-3.375.0396-1.199558-.0142-2.413731.24219-3.587891-.0222-1.061754-1.27193-1.818341-2.21354-1.303916-.4361.07207-.95475.446837-1.31358.0097-.30768-.168724-.69727-.282971-1.04124-.182359z"/><path id="path474" style="fill:#000;stroke-width:.204716" d="m478.08398 8.6914062c-3.04434.14731-5.7197 1.8438508-8.10248 3.6007978-1.72765 1.357081-2.97442 3.250966-3.63815 5.337598-2.26887 6.050536-2.21342 12.612826-2.40727 18.981009-.15743 8.550261.61576 17.100356 1.57762 25.572923.191 1.852456.35825 3.707256.52146 5.56236-2.14353 4.328099-4.51967 8.591659-7.70401 12.250805-2.36409 2.930614-4.6741 5.893283-7.25693 8.60857-1.23948.310478-2.55965.07497-3.80664-.115235-2.07257-.364678-3.86782-1.59835-5.23261-3.16249-1.81027-2.033779-3.15103-4.509976-3.85346-7.138711-.58177-3.373649.71016-6.7518 2.34552-9.649041.48255-.732833.88067-1.621841 1.6468-2.092726 2.34007-.143427 4.64989.535834 6.77539 1.46875.99634-.283035 1.63883-1.177063 2.49285-1.713624.99586-.778422 1.99114-1.557572 2.98762-2.335204-3.46085-1.340304-7.09892-2.967477-10.89987-2.427405-2.11783.508015-3.79571 2.000439-5.52392 3.235425-2.68145 2.341808-4.00679 5.78142-5.09379 9.076745-.89502 3.13538-.75704 6.605691.71513 9.548105 1.7092 3.847785 4.41928 7.489981 8.28686 9.356697 2.33088 1.021718 4.95868 1.325034 7.47457 1.052229 2.3056-.511534 4.29585-1.953137 6.00586-3.52539 2.54674-2.587205 4.77423-5.461403 7.04935-8.278252 1.52223-1.934278 3.11838-3.823289 4.42135-5.917061.59397 4.795158.8271 9.581025.6875 14.417969.0867 1.188555-.17941 2.681701.89258 3.509766.8519.734443 2.1919.630446 2.95133-.187286.77818-.629943 1.39784-1.430245 2.18539-2.050996.33463-4.101681.12961-8.221072.17483-12.330182-.0958-2.588148-.18458-5.17999-.3428-7.763568-.3245-1.63234-.58546-3.442123.28436-4.958718.51754-.816296 1.63351-.855617 2.47541-1.136985 1.29347-.223993 2.66956-.428758 3.95583-.11448 1.70322.767865 2.36308 2.681045 3.25511 4.18284 2.45359 5.01299 2.5034 10.662947 3.45117 16.066406.39453 1.998924.93975 4.059017 2.15761 5.723926 1.20516 1.352908 3.27678 1.341194 4.82481.637402 4.38174-1.593728 8.19236-4.35232 12.07422-6.859375 1.31644-.900078 2.96011-1.738505 3.51562-3.339844.18957-1.049313-1.14649-1.612884-1.96679-1.169922-.35611.233689-.66171.381595-1.10399.363009-2.26559.572321-3.99719 2.262336-6.02241 3.343699-2.07882 1.256166-4.16238 2.484729-6.55915 3.076496-.54459-.626324-.63649-1.53044-.94141-2.28711-.9522-3.598937-.99491-7.326699-1.76776-10.965895-.59128-3.450187-1.70586-6.83908-3.59788-9.802482-1.17173-2.100903-3.12486-4.124232-5.67959-4.213301-1.78692-.04961-3.60589.110612-5.3292.60205-.7058.211269-1.39123.486775-2.05525.805409 3.21714-7.057532 5.53801-14.470846 8.14459-21.764942 1.39013-3.996916 2.6535-8.095743 2.86422-12.350426.27986-3.961867.2851-7.946035.11578-11.911498-.22997-2.048169-.57126-4.334547-2.12459-5.8286024-1.48757-1.1781658-3.52717-.9718637-5.30079-.9902344zm-1.34765 5.0468748c.75756.100169 1.59662-.102993 2.29883.236328 1.20912 2.467702.83156 5.298741.93641 7.954687.0175 5.110463-.15302 10.311699-1.90356 15.185035-2.1116 6.637828-4.48624 13.179085-6.98769 19.684909-.22521.70112-.41136 1.033956-.41626.0992-.7906-7.151956-1.36504-14.321603-1.13549-21.539947.1018-5.837394.16128-11.671654 2.02378-17.234781.55964-1.515727 1.23048-3.250281 2.74843-4.035819.79358-.213639 1.61188-.339885 2.43555-.34961zm-4.6543 76.720703c.62866.420068-.45727 1.13443-.58012.305527-.23418-.244089.43497-.422407.58012-.305527z"/><path id="path476" style="fill:#000;stroke-width:.204716" d="m444.84375 25.214844c-1.64773.385233-3.25602 1.067363-4.67561 1.987852-2.04086 1.6493-3.49412 3.884237-5.29746 5.771289-2.66063 2.970824-5.68987 5.575842-8.77289 8.092454-.58007.602259-1.39502 1.328599-1.25795 2.242155.25323.910636 1.38471.929547 2.11011.630268 1.39615-.334178 2.69141-1.03155 3.91085-1.761623 4.12198-3.246933 7.92443-6.902681 11.24802-10.966954 1.09459-1.394037 2.48316-2.522459 3.55811-3.926379.59161-.629078.42113-1.908335-.5224-2.035859-.10001-.0081-.19903-.06601-.30078-.0332z"/><path id="path510" style="fill:#000;stroke:#000;stroke-width:.0832446" d="m156.66797 65.568359c-1.40281.04819-2.00876 2.164215-.79102 2.908203 1.10643.978518 2.94358-.355474 2.51367-1.714843-.18241-.751321-.9599-1.271376-1.72265-1.19336z"/><path id="path512" style="fill:#000;stroke:#000;stroke-width:.0832446" d="m156.66797 65.568359c-1.40281.04819-2.00876 2.164215-.79102 2.908203 1.10643.978518 2.94358-.355474 2.51367-1.714843-.18241-.751321-.9599-1.271376-1.72265-1.19336z"/><path id="path1432" style="fill:#000;stroke-width:.202157" d="m94.878906 30.269531c-2.287631.898028-4.703901 1.605195-6.807724 2.877579-4.485024 5.491989-6.611133 12.401509-8.442948 19.132856-1.605329 6.046121-2.840557 12.204453-4.985613 18.095796-2.771657 8.014773-6.035967 15.844748-10.868943 22.859542-1.749947 2.479612-3.601343 4.885482-5.392819 7.335006 2.85849-1.26468 5.716446-2.530574 8.574219-3.796872 6.610002-8.720957 10.691919-19.019319 14.096589-29.330787 2.790753-8.7136 4.127071-17.89265 7.79901-26.319883 1.235636-2.821633 2.900303-5.441874 4.898209-7.783699.952846-1.237371 1.905694-2.474742 2.858536-3.712116-.576172.214193-1.152344.428386-1.728516.642578z"/><path id="path1434" style="fill:#000;stroke-width:.202157" d="m93.257812 30.740234c-1.733368.858571-3.440196 1.845878-5.164062 2.751954.810252 5.34993 3.024219 10.347909 4.425405 15.521466 2.072478 6.784453 3.847313 13.681516 5.505429 20.598588 1.180239 4.908903 1.729165 9.94751 2.987136 14.836977.96649 3.670046 2.49394 7.275685 4.9564 10.198384.78807.844102 1.64803 1.682248 2.67836 2.213725.88334.191728 1.43837-.72189 2.17288-1.03501 1.14091-.744883 2.2825-1.48873 3.42283-2.234521-1.77857-1.19183-3.63718-2.460542-4.64263-4.417814-3.0829-4.597975-3.70366-10.234336-4.77902-15.52966-.8585-4.588927-2.03141-9.108024-3.16222-13.634617-.51284-2.223885-1.15403-4.419896-1.735477-6.627752-1.569505-5.662739-3.34325-11.323358-5.050111-16.90562-.517229-1.710922-.87143-3.482123-.92156-5.26735-.0439-.278108-.408679-.604452-.69336-.46875zm7.623048 27.275391c-.2376.743408-1.454441-.29859-.48492-.165475.15225.06679.66504-.188859.48492.165475z"/><path id="path1440" style="fill:#000;stroke-width:.202157" d="m93.693359 58.945312c-4.070097.13705-8.123695.652337-12.201562.568416-3.492748.01042-6.98542-.0175-10.478125-.02935-2.241288 1.678066-4.483664 3.354679-6.72461 5.033203 6.767011-.175815 13.540661.04814 20.304958-.196194 5.878883-.507678 11.806803-.677339 17.69857-.02042 1.78153.149956 3.55694.456984 5.32078.675666 1.05621-.117502 1.71027-1.096398 2.59049-1.591397 1.38565-1.016663 2.77006-2.035027 4.15747-3.049296-3.12468-.07048-6.17775-.620639-9.27187-.956016-3.16628-.218965-6.328998-.549518-9.507395-.458409-.629656-.01131-1.259141.01642-1.888706.0238z"/><path id="path1442" style="fill:#000;stroke-width:.202157" d="m137.80273 32.195312c-.71131-.02645-1.22365.533659-1.76757.896485-3.32296-.648355-6.5358.949258-9.31521 2.591857-4.13708 2.423361-8.39589 5.160194-10.8685 9.405801-2.81817 4.65217-3.70379 10.122397-4.38312 15.431557-.71678 4.62043-.63171 9.312129-.6621 13.974246-.17073 3.941542 1.22301 7.714025 2.78316 11.263402 1.47756 3.374971 2.98687 6.93403 5.78974 9.440876 2.60206 2.103977 5.98229 2.938743 9.26997 3.079382 3.01616.178255 6.04839.197489 9.0654.05924 3.25526-.352297 6.13656-2.210964 8.52083-4.353872 1.9125-1.802379 3.23536-4.122029 4.467-6.415823 1.96654-3.819715 2.97141-8.06343 3.32178-12.327816.63197-6.298061.53467-12.640058.51157-18.961602-.31286-6.555578-3.34059-12.6311-7.00772-17.94516-1.36398-2.116257-3.08084-4.117768-5.41961-5.176398-1.33498-.643965-2.82253-.990471-4.30562-.962179zm.92969 5.699219c2.47608 1.49523 3.89223 4.131017 5.42803 6.481762 2.3619 3.875065 4.21223 8.273459 4.57393 12.778004.10946 3.540014.0754 7.199129.0226 10.786117-.13267 4.59801-.30727 9.207498-1.382 13.719742-.93846 3.818379-2.73823 7.354917-5.25828 10.371228-.54974.799923-1.41776 1.322856-2.39992 1.343616-2.75225.198886-5.52039.102639-8.2763.011-2.77568-.07296-5.73025-.633233-7.86708-2.529377-2.10928-2.179327-3.28872-5.047642-4.51317-7.774861-1.11282-2.692425-2.33357-5.39614-2.44851-8.361666-.14085-3.190521-.0674-6.390597.0562-9.581427.14975-3.270265.65943-6.610104 1.17386-9.878406.69163-3.869378 1.85813-7.786775 4.2574-10.998784 1.95471-2.475077 4.54847-4.446958 7.40796-5.758508 1.93693-.843915 4.24175-.844849 6.06259.206969.44889.199604.90067.715415 1.31312.18647.57632-.317847 1.12482-.8901 1.71804-1.053332l.0931.03644z"/><path id="path2471" style="fill:#000;stroke-width:.202157" d="m19.875-1.1464844c-2.467326.20038379-4.416995 1.8977635-6.465485 3.1000412-2.092157 1.6351412-3.347691 4.0900298-4.3407045 6.4976497-1.162515 3.0913185-1.9649042 6.3534035-2.1332636 9.6581685-.020817 3.848753 1.14656 7.564265 2.0214843 11.275391.9423091 3.535474 1.9990858 7.038851 3.0273438 10.550781-3.558475 2.085762-7.2987095 4.432847-9.2179466 8.23808-1.91058832 3.644811-3.22225643 7.686999-3.32760678 11.823119.0280441 1.872592 1.03030634 3.785445 2.80262948 4.546582 2.8585542 1.517064 6.1649538 1.732272 9.3167369 2.130179 2.211118.216219 4.432631.329845 6.654703.314774.344948 5.553728.702102 11.179714-.130052 16.708708-.113818.436681-.01061 1.276409-.671293.840427-3.346086-.889374-7.010389-.937983-10.2533429.368834-1.4220886.706309-2.8423797 1.439918-4.1587002 2.330061-1.4833855 1.011485-2.50642305 2.816075-2.15738584 4.639764.27670544 1.50483.83204454 2.946746 1.31812824 4.392702 1.0029707 2.447538 2.6634652 4.859863 5.174811 5.915053 1.664462.60635 3.4565307-.0423 4.8542497-.98599 2.199044-1.234 4.187541-2.882528 5.579001-5.004834 1.075465-1.478272 2.02244-3.044267 2.962162-4.610975 3.73972 1.912958 7.639363 3.750579 11.866027 4.220964 5.229014.819247 10.534141 1.238137 15.827896 1.103707 4.609822-.188519 9.320543-1.100025 13.28447-3.57145 2.628989-1.435801 5.127933-3.288571 6.707934-5.886007 2.551407-3.93756 3.549201-8.680994 3.793283-13.30966.08651-4.065033-.232752-8.209911-1.679065-12.044616-1.683663-4.622633-4.346852-8.915431-7.956449-12.282379-4.78356-4.628438-10.902243-7.535639-17.076681-9.825795-7.576235-2.890711-15.799324-3.887274-23.870477-3.415234-1.45148.184805-2.908547.38467-4.31686.793673-1.772122-6.15093-3.742629-12.328265-4.585432-18.662232-.243926-3.049717.472069-6.06426 1.365298-8.9933226.743461-2.0621443 1.62728-4.2323716 3.323377-5.6960226.804625-.5857958 1.775496.026879 2.575239.3129153.608663.2214678 1.178371.9384883.681754 1.546329-.687235 1.1336659-1.997566 1.6924602-2.676648 2.8375411-.420302.6993466-1.297068 1.3490728-.984369 2.2680738.448857.947951 1.697752.638275 2.485067.36589 1.793577-.782484 3.519119-1.7891435 5.009073-3.0651091 1.372296-1.2711291 2.618085-3.140637 2.133059-5.0953206-.549199-2.41423932-3.002514-3.84881267-5.297121-4.2288982-.484264-.078-.974257-.1160508-1.464844-.1015625zm2.066406 42.4824224c5.853967-.03158 11.785551.546324 17.387283 2.30404 4.052566 1.30083 8.026984 2.903842 11.762369 4.951333 5.171419 2.854776 9.830438 7.20005 12.475348 12.525877 1.234364 2.513606 2.149442 5.042218 2.600007 7.830174.348285 2.619998.47256 5.234756.24345 7.882353-.425086 3.919758-1.452478 7.980039-4.029004 11.066769-.637384.750619-1.422851 1.348609-2.123047 2.027344-3.417276 1.602835-7.25638 2.104568-11.001905 2.182687-4.985171.02644-9.943714-.403025-14.861623-1.232555-3.16245-.549877-6.092862-1.904429-8.944116-3.320687-.838298-.398379-1.679269-.793986-2.540012-1.141164 1.812739-5.97312 1.288897-12.293939 1.067125-18.439473.08478-.454615-.401074-1.38791.322921-1.299128 3.346957-.366107 6.725447-.875339 9.86123-2.155826 2.572518-.853242 5.295532-1.091423 7.965567-1.478959.642141-.03087 1.250964-.146033 1.697525-.648911 2.229063-1.713274 4.457918-3.426817 6.687195-5.139812-4.945597.703564-9.950537 1.113255-14.814788 2.283884-1.61454.601637-3.200266 1.331198-4.929937 1.532373-2.392654.476772-4.818149.835899-7.265041.964993-.635149-6.333213-1.951949-12.621946-4.230469-18.576172-.181271-.560347-.446635-1.227831-.632812-1.841797 1.092247-.174855 2.197184-.257762 3.302734-.277343zm-8.710937 2.630859c1.73383 4.920162 3.416007 9.901736 4.097298 15.096077.154901 1.011684.293383 2.025855.410514 3.042595-3.639733-.157396-7.270674-.462804-10.7617185-1.548828-.916187-.285016-1.9318113-.99391-1.7441406-2.091797.067658-2.619841.815338-5.182345 1.7460937-7.615235 1.0452584-2.582819 2.7582053-5.072404 5.2017964-6.593561.355667-.148591.965967-1.118661 1.0366-.331886zM11.498047 88.84375c1.581425.113622 3.132072.488669 4.638672.970703-1.320122 2.612878-3.004131 5.040366-4.855469 7.300781-.497488.672024-1.249391-.0561-1.6745127-.424631-1.8941345-1.83007-2.544719-4.510543-3.0598623-6.995291.5756926-.538238 1.4988482-.576207 2.2554181-.731905.8912275-.117794 1.7976289-.18021 2.6957539-.119657z"/></svg>
</a>
</div><div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div><script type=text/javascript src=/js/lunr.min.js?1646789669></script>
<script type=text/javascript src=/js/auto-complete.js?1646789669></script>
<script type=text/javascript>var baseurl="https://artisanbox.github.io"</script>
<script type=text/javascript src=/js/search.js?1646789669></script>
</div><section id=homelinks>
<ul>
<li>
<a class=padding href=/><i class="fas fa-home"></i> Gen 的学习笔记</a>
</li></ul></section><div class=highlightable>
<ul class=topics>
<li data-nav-id=/1/ title=MySQL实战45讲 class="dd-item
parent">
<a href=/1/>
MySQL实战45讲
</a>
<ul>
<li data-nav-id=/1/1/ title=01_基础架构：一条SQL查询语句是如何执行的？ class=dd-item>
<a href=/1/1/>
01_基础架构：一条SQL查询语句是如何执行的？
</a>
</li><li data-nav-id=/1/2/ title=02_日志系统：一条SQL更新语句是如何执行的？ class=dd-item>
<a href=/1/2/>
02_日志系统：一条SQL更新语句是如何执行的？
</a>
</li><li data-nav-id=/1/3/ title=03_事务隔离：为什么你改了我还看不见？ class=dd-item>
<a href=/1/3/>
03_事务隔离：为什么你改了我还看不见？
</a>
</li><li data-nav-id=/1/4/ title=04_深入浅出索引（上） class=dd-item>
<a href=/1/4/>
04_深入浅出索引（上）
</a>
</li><li data-nav-id=/1/5/ title=05_深入浅出索引（下） class=dd-item>
<a href=/1/5/>
05_深入浅出索引（下）
</a>
</li><li data-nav-id=/1/6/ title=06_全局锁和表锁：给表加个字段怎么有这么多阻碍？ class=dd-item>
<a href=/1/6/>
06_全局锁和表锁：给表加个字段怎么有这么多阻碍？
</a>
</li><li data-nav-id=/1/7/ title=07_行锁功过：怎么减少行锁对性能的影响？ class=dd-item>
<a href=/1/7/>
07_行锁功过：怎么减少行锁对性能的影响？
</a>
</li><li data-nav-id=/1/8/ title=08_事务到底是隔离的还是不隔离的？ class=dd-item>
<a href=/1/8/>
08_事务到底是隔离的还是不隔离的？
</a>
</li><li data-nav-id=/1/9/ title=09_普通索引和唯一索引，应该怎么选择？ class=dd-item>
<a href=/1/9/>
09_普通索引和唯一索引，应该怎么选择？
</a>
</li><li data-nav-id=/1/10/ title=10_MySQL为什么有时候会选错索引？ class=dd-item>
<a href=/1/10/>
10_MySQL为什么有时候会选错索引？
</a>
</li><li data-nav-id=/1/11/ title=11_怎么给字符串字段加索引？ class=dd-item>
<a href=/1/11/>
11_怎么给字符串字段加索引？
</a>
</li><li data-nav-id=/1/12/ title=12_为什么我的MySQL会“抖”一下？ class=dd-item>
<a href=/1/12/>
12_为什么我的MySQL会“抖”一下？
</a>
</li><li data-nav-id=/1/13/ title=13_为什么表数据删掉一半，表文件大小不变？ class=dd-item>
<a href=/1/13/>
13_为什么表数据删掉一半，表文件大小不变？
</a>
</li><li data-nav-id=/1/14/ title=14_count(x)这么慢，我该怎么办？ class=dd-item>
<a href=/1/14/>
14_count(x)这么慢，我该怎么办？
</a>
</li><li data-nav-id=/1/15/ title=15_答疑文章（一）：日志和索引相关问题 class=dd-item>
<a href=/1/15/>
15_答疑文章（一）：日志和索引相关问题
</a>
</li><li data-nav-id=/1/16/ title=16_“orderby”是怎么工作的？ class=dd-item>
<a href=/1/16/>
16_“orderby”是怎么工作的？
</a>
</li><li data-nav-id=/1/17/ title=17_如何正确地显示随机消息？ class=dd-item>
<a href=/1/17/>
17_如何正确地显示随机消息？
</a>
</li><li data-nav-id=/1/18/ title=18_为什么这些SQL语句逻辑相同，性能却差异巨大？ class="dd-item active">
<a href=/1/18/>
18_为什么这些SQL语句逻辑相同，性能却差异巨大？
</a>
</li><li data-nav-id=/1/19/ title=19_为什么我只查一行的语句，也执行这么慢？ class=dd-item>
<a href=/1/19/>
19_为什么我只查一行的语句，也执行这么慢？
</a>
</li><li data-nav-id=/1/20/ title=20_幻读是什么，幻读有什么问题？ class=dd-item>
<a href=/1/20/>
20_幻读是什么，幻读有什么问题？
</a>
</li><li data-nav-id=/1/21/ title=21_为什么我只改一行的语句，锁这么多？ class=dd-item>
<a href=/1/21/>
21_为什么我只改一行的语句，锁这么多？
</a>
</li><li data-nav-id=/1/22/ title=22_MySQL有哪些“饮鸩止渴”提高性能的方法？ class=dd-item>
<a href=/1/22/>
22_MySQL有哪些“饮鸩止渴”提高性能的方法？
</a>
</li><li data-nav-id=/1/23/ title=23_MySQL是怎么保证数据不丢的？ class=dd-item>
<a href=/1/23/>
23_MySQL是怎么保证数据不丢的？
</a>
</li><li data-nav-id=/1/24/ title=24_MySQL是怎么保证主备一致的？ class=dd-item>
<a href=/1/24/>
24_MySQL是怎么保证主备一致的？
</a>
</li><li data-nav-id=/1/25/ title=25_MySQL是怎么保证高可用的？ class=dd-item>
<a href=/1/25/>
25_MySQL是怎么保证高可用的？
</a>
</li><li data-nav-id=/1/26/ title=26_备库为什么会延迟好几个小时？ class=dd-item>
<a href=/1/26/>
26_备库为什么会延迟好几个小时？
</a>
</li><li data-nav-id=/1/27/ title=27_主库出问题了，从库怎么办？ class=dd-item>
<a href=/1/27/>
27_主库出问题了，从库怎么办？
</a>
</li><li data-nav-id=/1/28/ title=28_读写分离有哪些坑？ class=dd-item>
<a href=/1/28/>
28_读写分离有哪些坑？
</a>
</li><li data-nav-id=/1/29/ title=29_如何判断一个数据库是不是出问题了？ class=dd-item>
<a href=/1/29/>
29_如何判断一个数据库是不是出问题了？
</a>
</li><li data-nav-id=/1/30/ title=30_答疑文章（二）：用动态的观点看加锁 class=dd-item>
<a href=/1/30/>
30_答疑文章（二）：用动态的观点看加锁
</a>
</li><li data-nav-id=/1/31/ title=31_误删数据后除了跑路，还能怎么办？ class=dd-item>
<a href=/1/31/>
31_误删数据后除了跑路，还能怎么办？
</a>
</li><li data-nav-id=/1/32/ title=32_为什么还有kill不掉的语句？ class=dd-item>
<a href=/1/32/>
32_为什么还有kill不掉的语句？
</a>
</li><li data-nav-id=/1/33/ title=33_我查这么多数据，会不会把数据库内存打爆？ class=dd-item>
<a href=/1/33/>
33_我查这么多数据，会不会把数据库内存打爆？
</a>
</li><li data-nav-id=/1/34/ title=34_到底可不可以使用join？ class=dd-item>
<a href=/1/34/>
34_到底可不可以使用join？
</a>
</li><li data-nav-id=/1/35/ title=35_join语句怎么优化？ class=dd-item>
<a href=/1/35/>
35_join语句怎么优化？
</a>
</li><li data-nav-id=/1/36/ title=36_为什么临时表可以重名？ class=dd-item>
<a href=/1/36/>
36_为什么临时表可以重名？
</a>
</li><li data-nav-id=/1/37/ title=37_什么时候会使用内部临时表？ class=dd-item>
<a href=/1/37/>
37_什么时候会使用内部临时表？
</a>
</li><li data-nav-id=/1/38/ title=38_都说InnoDB好，那还要不要使用Memory引擎？ class=dd-item>
<a href=/1/38/>
38_都说InnoDB好，那还要不要使用Memory引擎？
</a>
</li><li data-nav-id=/1/39/ title=39_自增主键为什么不是连续的？ class=dd-item>
<a href=/1/39/>
39_自增主键为什么不是连续的？
</a>
</li><li data-nav-id=/1/40/ title=40_insert语句的锁为什么这么多？ class=dd-item>
<a href=/1/40/>
40_insert语句的锁为什么这么多？
</a>
</li><li data-nav-id=/1/41/ title=41_怎么最快地复制一张表？ class=dd-item>
<a href=/1/41/>
41_怎么最快地复制一张表？
</a>
</li><li data-nav-id=/1/42/ title=42_grant之后要跟着flushprivileges吗？ class=dd-item>
<a href=/1/42/>
42_grant之后要跟着flushprivileges吗？
</a>
</li><li data-nav-id=/1/43/ title=43_要不要使用分区表？ class=dd-item>
<a href=/1/43/>
43_要不要使用分区表？
</a>
</li><li data-nav-id=/1/44/ title=44_答疑文章（三）：说一说这些好问题 class=dd-item>
<a href=/1/44/>
44_答疑文章（三）：说一说这些好问题
</a>
</li><li data-nav-id=/1/45/ title=45_自增id用完怎么办？ class=dd-item>
<a href=/1/45/>
45_自增id用完怎么办？
</a>
</li><li data-nav-id=/1/47/ title=开篇词_这一次，让我们一起来搞懂MySQL class=dd-item>
<a href=/1/47/>
开篇词_这一次，让我们一起来搞懂MySQL
</a>
</li><li data-nav-id=/1/48/ title=直播回顾_林晓斌：我的MySQL心路历程 class=dd-item>
<a href=/1/48/>
直播回顾_林晓斌：我的MySQL心路历程
</a>
</li><li data-nav-id=/1/46/ title=结束语_点线网面，一起构建MySQL知识网络 class=dd-item>
<a href=/1/46/>
结束语_点线网面，一起构建MySQL知识网络
</a>
</li><li data-nav-id=/1/49/ title=结课测试｜这些MySQL知识你都掌握了吗？ class=dd-item>
<a href=/1/49/>
结课测试｜这些MySQL知识你都掌握了吗？
</a>
</li></ul></li></ul><section id=footer>
<p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body>
<div id=overlay></div><div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=/>Gen 的学习笔记</a> > <a href=/1/>MySQL实战45讲</a> > 18_为什么这些SQL语句逻辑相同，性能却差异巨大？
</span>
</div><div class=progress>
<div class=wrapper>
<nav id=TableOfContents></nav></div></div></div></div><div id=head-tags>
</div><div id=body-inner>
<h1>
18_为什么这些SQL语句逻辑相同，性能却差异巨大？
</h1><p><audio title="18 _ 为什么这些SQL语句逻辑相同，性能却差异巨大？" src=https://static001.geekbang.org/resource/audio/79/46/79eb1abbbbbbdf2ade89fc4156b34d46.mp3 controls></audio></p><p>在MySQL中，有很多看上去逻辑相同，但性能却差异巨大的SQL语句。对这些语句使用不当的话，就会不经意间导致整个数据库的压力变大。</p><p>我今天挑选了三个这样的案例和你分享。希望再遇到相似的问题时，你可以做到举一反三、快速解决问题。</p><h1>案例一：条件字段函数操作</h1><p>假设你现在维护了一个交易系统，其中交易记录表tradelog包含交易流水号（tradeid）、交易员id（operator）、交易时间（t_modified）等字段。为了便于描述，我们先忽略其他字段。这个表的建表语句如下：</p><pre><code>mysql&gt; CREATE TABLE `tradelog` (
  `id` int(11) NOT NULL,
  `tradeid` varchar(32) DEFAULT NULL,
  `operator` int(11) DEFAULT NULL,
  `t_modified` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `tradeid` (`tradeid`),
  KEY `t_modified` (`t_modified`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
</code></pre><p>假设，现在已经记录了从2016年初到2018年底的所有数据，运营部门有一个需求是，要统计发生在所有年份中7月份的交易记录总数。这个逻辑看上去并不复杂，你的SQL语句可能会这么写：</p><pre><code>mysql&gt; select count(*) from tradelog where month(t_modified)=7;
</code></pre><p>由于t_modified字段上有索引，于是你就很放心地在生产库中执行了这条语句，但却发现执行了特别久，才返回了结果。</p><p>如果你问DBA同事为什么会出现这样的情况，他大概会告诉你：如果对字段做了函数计算，就用不上索引了，这是MySQL的规定。</p><p>现在你已经学过了InnoDB的索引结构了，可以再追问一句为什么？为什么条件是where t_modified='2018-7-1’的时候可以用上索引，而改成where month(t_modified)=7的时候就不行了？</p><p>下面是这个t_modified索引的示意图。方框上面的数字就是month()函数对应的值。</p><p><img src=https://static001.geekbang.org/resource/image/3e/86/3e30d9a5e67f711f5af2e2599e800286.png alt></p><center><span class=reference>图1 t_modified索引示意图</span></center><p>如果你的SQL语句条件用的是where t_modified='2018-7-1’的话，引擎就会按照上面绿色箭头的路线，快速定位到 t_modified='2018-7-1’需要的结果。</p><p>实际上，B+树提供的这个快速定位能力，来源于同一层兄弟节点的有序性。</p><p>但是，如果计算month()函数的话，你会看到传入7的时候，在树的第一层就不知道该怎么办了。</p><p>也就是说，<strong>对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。</strong></p><p>需要注意的是，优化器并不是要放弃使用这个索引。</p><p>在这个例子里，放弃了树搜索功能，优化器可以选择遍历主键索引，也可以选择遍历索引t_modified，优化器对比索引大小后发现，索引t_modified更小，遍历这个索引比遍历主键索引来得更快。因此最终还是会选择索引t_modified。</p><p>接下来，我们使用explain命令，查看一下这条SQL语句的执行结果。</p><p><img src=https://static001.geekbang.org/resource/image/27/55/27c2f5ff3549b18ba37a28f4919f3655.png alt></p><center><span class=reference>图2 explain 结果</span></center><p>key="t_modified"表示的是，使用了t_modified这个索引；我在测试表数据中插入了10万行数据，rows=100335，说明这条语句扫描了整个索引的所有值；Extra字段的Using index，表示的是使用了覆盖索引。</p><p>也就是说，由于在t_modified字段加了month()函数操作，导致了全索引扫描。为了能够用上索引的快速定位能力，我们就要把SQL语句改成基于字段本身的范围查询。按照下面这个写法，优化器就能按照我们预期的，用上t_modified索引的快速定位能力了。</p><pre><code>mysql&gt; select count(*) from tradelog where
    -&gt; (t_modified &gt;= '2016-7-1' and t_modified&lt;'2016-8-1') or
    -&gt; (t_modified &gt;= '2017-7-1' and t_modified&lt;'2017-8-1') or 
    -&gt; (t_modified &gt;= '2018-7-1' and t_modified&lt;'2018-8-1');
</code></pre><p>当然，如果你的系统上线时间更早，或者后面又插入了之后年份的数据的话，你就需要再把其他年份补齐。</p><p>到这里我给你说明了，由于加了month()函数操作，MySQL无法再使用索引快速定位功能，而只能使用全索引扫描。</p><p>不过优化器在个问题上确实有“偷懒”行为，即使是对于不改变有序性的函数，也不会考虑使用索引。比如，对于select * from tradelog where id + 1 = 10000这个SQL语句，这个加1操作并不会改变有序性，但是MySQL优化器还是不能用id索引快速定位到9999这一行。所以，需要你在写SQL语句的时候，手动改写成 where id = 10000 -1才可以。</p><h1>案例二：隐式类型转换</h1><p>接下来我再跟你说一说，另一个经常让程序员掉坑里的例子。</p><p>我们一起看一下这条SQL语句：</p><pre><code>mysql&gt; select * from tradelog where tradeid=110717;
</code></pre><p>交易编号tradeid这个字段上，本来就有索引，但是explain的结果却显示，这条语句需要走全表扫描。你可能也发现了，tradeid的字段类型是varchar(32)，而输入的参数却是整型，所以需要做类型转换。</p><p>那么，现在这里就有两个问题：</p><ol>
<li>
<p>数据类型转换的规则是什么？</p></li><li>
<p>为什么有数据类型转换，就需要走全索引扫描？</p></li></ol><p>先来看第一个问题，你可能会说，数据库里面类型这么多，这种数据类型转换规则更多，我记不住，应该怎么办呢？</p><p>这里有一个简单的方法，看 select “10” > 9的结果：</p><ol>
<li>
<p>如果规则是“将字符串转成数字”，那么就是做数字比较，结果应该是1；</p></li><li>
<p>如果规则是“将数字转成字符串”，那么就是做字符串比较，结果应该是0。</p></li></ol><p>验证结果如图3所示。</p><p><img src=https://static001.geekbang.org/resource/image/2b/14/2b67fc38f1651e2622fe21d49950b214.png alt></p><center><span class=reference>图3 MySQL中字符串和数字转换的效果示意图</span></center><p>从图中可知，select “10” > 9返回的是1，所以你就能确认MySQL里的转换规则了：在MySQL中，字符串和数字做比较的话，是将字符串转换成数字。</p><p>这时，你再看这个全表扫描的语句：</p><pre><code>mysql&gt; select * from tradelog where tradeid=110717;
</code></pre><p>就知道对于优化器来说，这个语句相当于：</p><pre><code>mysql&gt; select * from tradelog where  CAST(tradid AS signed int) = 110717;
</code></pre><p>也就是说，这条语句触发了我们上面说到的规则：对索引字段做函数操作，优化器会放弃走树搜索功能。</p><p>现在，我留给你一个小问题，id的类型是int，如果执行下面这个语句，是否会导致全表扫描呢？</p><pre><code>select * from tradelog where id=&quot;83126&quot;;
</code></pre><p>你可以先自己分析一下，再到数据库里面去验证确认。</p><p>接下来，我们再来看一个稍微复杂点的例子。</p><h1>案例三：隐式字符编码转换</h1><p>假设系统里还有另外一个表trade_detail，用于记录交易的操作细节。为了便于量化分析和复现，我往交易日志表tradelog和交易详情表trade_detail这两个表里插入一些数据。</p><pre><code>mysql&gt; CREATE TABLE `trade_detail` (
  `id` int(11) NOT NULL,
  `tradeid` varchar(32) DEFAULT NULL,
  `trade_step` int(11) DEFAULT NULL, /*操作步骤*/
  `step_info` varchar(32) DEFAULT NULL, /*步骤信息*/
  PRIMARY KEY (`id`),
  KEY `tradeid` (`tradeid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
<p>insert into tradelog values(1, &lsquo;aaaaaaaa&rsquo;, 1000, now());
insert into tradelog values(2, &lsquo;aaaaaaab&rsquo;, 1000, now());
insert into tradelog values(3, &lsquo;aaaaaaac&rsquo;, 1000, now());</p>
<p>insert into trade_detail values(1, &lsquo;aaaaaaaa&rsquo;, 1, &lsquo;add&rsquo;);
insert into trade_detail values(2, &lsquo;aaaaaaaa&rsquo;, 2, &lsquo;update&rsquo;);
insert into trade_detail values(3, &lsquo;aaaaaaaa&rsquo;, 3, &lsquo;commit&rsquo;);
insert into trade_detail values(4, &lsquo;aaaaaaab&rsquo;, 1, &lsquo;add&rsquo;);
insert into trade_detail values(5, &lsquo;aaaaaaab&rsquo;, 2, &lsquo;update&rsquo;);
insert into trade_detail values(6, &lsquo;aaaaaaab&rsquo;, 3, &lsquo;update again&rsquo;);
insert into trade_detail values(7, &lsquo;aaaaaaab&rsquo;, 4, &lsquo;commit&rsquo;);
insert into trade_detail values(8, &lsquo;aaaaaaac&rsquo;, 1, &lsquo;add&rsquo;);
insert into trade_detail values(9, &lsquo;aaaaaaac&rsquo;, 2, &lsquo;update&rsquo;);
insert into trade_detail values(10, &lsquo;aaaaaaac&rsquo;, 3, &lsquo;update again&rsquo;);
insert into trade_detail values(11, &lsquo;aaaaaaac&rsquo;, 4, &lsquo;commit&rsquo;);
</code></pre><p>这时候，如果要查询id=2的交易的所有操作步骤信息，SQL语句可以这么写：</p><pre><code>mysql&gt; select d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid and l.id=2; /<em>语句Q1</em>/
</code></pre><p><img src=https://static001.geekbang.org/resource/image/ad/22/adfe464af1d15f3261b710a806c0fa22.png alt></p><center><span class=reference>图4 语句Q1的explain 结果</span></center><p>我们一起来看下这个结果：</p><ol></p><li>
<p>第一行显示优化器会先在交易记录表tradelog上查到id=2的行，这个步骤用上了主键索引，rows=1表示只扫描一行；</p></li><li>
<p>第二行key=NULL，表示没有用上交易详情表trade_detail上的tradeid索引，进行了全表扫描。</p></li></ol><p>在这个执行计划里，是从tradelog表中取tradeid字段，再去trade_detail表里查询匹配字段。因此，我们把tradelog称为驱动表，把trade_detail称为被驱动表，把tradeid称为关联字段。</p><p>接下来，我们看下这个explain结果表示的执行流程：</p><p><img src=https://static001.geekbang.org/resource/image/82/a9/8289c184c8529acea0269a7460dc62a9.png alt></p><center><span class=reference>图5 语句Q1的执行过程</span></center><p>图中：</p><ul>
<li>第1步，是根据id在tradelog表里找到L2这一行；</li><li>第2步，是从L2中取出tradeid字段的值；</li><li>第3步，是根据tradeid值到trade_detail表中查找条件匹配的行。explain的结果里面第二行的key=NULL表示的就是，这个过程是通过遍历主键索引的方式，一个一个地判断tradeid的值是否匹配。</li></ul><p>进行到这里，你会发现第3步不符合我们的预期。因为表trade_detail里tradeid字段上是有索引的，我们本来是希望通过使用tradeid索引能够快速定位到等值的行。但，这里并没有。</p><p>如果你去问DBA同学，他们可能会告诉你，因为这两个表的字符集不同，一个是utf8，一个是utf8mb4，所以做表连接查询的时候用不上关联字段的索引。这个回答，也是通常你搜索这个问题时会得到的答案。</p><p>但是你应该再追问一下，为什么字符集不同就用不上索引呢？</p><p>我们说问题是出在执行步骤的第3步，如果单独把这一步改成SQL语句的话，那就是：</p><pre><code>mysql&gt; select * from trade_detail where tradeid=$L2.tradeid.value; 
</code></pre><p>其中，$L2.tradeid.value的字符集是utf8mb4。</p><p>参照前面的两个例子，你肯定就想到了，字符集utf8mb4是utf8的超集，所以当这两个类型的字符串在做比较的时候，MySQL内部的操作是，先把utf8字符串转成utf8mb4字符集，再做比较。</p><blockquote>
<p>这个设定很好理解，utf8mb4是utf8的超集。类似地，在程序设计语言里面，做自动类型转换的时候，为了避免数据在转换过程中由于截断导致数据错误，也都是“按数据长度增加的方向”进行转换的。</p></blockquote><p>因此， 在执行上面这个语句的时候，需要将被驱动数据表里的字段一个个地转换成utf8mb4，再跟L2做比较。</p><p>也就是说，实际上这个语句等同于下面这个写法：</p><pre><code>select * from trade_detail  where CONVERT(traideid USING utf8mb4)=$L2.tradeid.value; 
</code></pre><p>CONVERT()函数，在这里的意思是把输入的字符串转成utf8mb4字符集。</p><p>这就再次触发了我们上面说到的原则：对索引字段做函数操作，优化器会放弃走树搜索功能。</p><p>到这里，你终于明确了，字符集不同只是条件之一，<strong>连接过程中要求在被驱动表的索引字段上加函数操作</strong>，是直接导致对被驱动表做全表扫描的原因。</p><p>作为对比验证，我给你提另外一个需求，“查找trade_detail表里id=4的操作，对应的操作者是谁”，再来看下这个语句和它的执行计划。</p><pre><code>mysql&gt;select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4;
</code></pre><p><img src=https://static001.geekbang.org/resource/image/92/11/92cb498ceb3557e41700fae53ce9bd11.png alt></p><center><span class=reference>图6 explain 结果</span></center><p>这个语句里trade_detail 表成了驱动表，但是explain结果的第二行显示，这次的查询操作用上了被驱动表tradelog里的索引(tradeid)，扫描行数是1。</p><p>这也是两个tradeid字段的join操作，为什么这次能用上被驱动表的tradeid索引呢？我们来分析一下。</p><p>假设驱动表trade_detail里id=4的行记为R4，那么在连接的时候（图5的第3步），被驱动表tradelog上执行的就是类似这样的SQL 语句：</p><pre><code>select operator from tradelog  where traideid =$R4.tradeid.value; 
</code></pre><p>这时候$R4.tradeid.value的字符集是utf8, 按照字符集转换规则，要转成utf8mb4，所以这个过程就被改写成：</p><pre><code>select operator from tradelog  where traideid =CONVERT($R4.tradeid.value USING utf8mb4); 
</code></pre><p>你看，这里的CONVERT函数是加在输入参数上的，这样就可以用上被驱动表的traideid索引。</p><p>理解了原理以后，就可以用来指导操作了。如果要优化语句</p><pre><code>select d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid and l.id=2;
</code></pre><p>的执行过程，有两种做法：</p><ul>
<li>比较常见的优化方法是，把trade_detail表上的tradeid字段的字符集也改成utf8mb4，这样就没有字符集转换的问题了。</li></ul><pre><code>alter table trade_detail modify tradeid varchar(32) CHARACTER SET utf8mb4 default null;
</code></pre><ul>
<li>如果能够修改字段的字符集的话，是最好不过了。但如果数据量比较大， 或者业务上暂时不能做这个DDL的话，那就只能采用修改SQL语句的方法了。</li></ul><pre><code>mysql&gt; select d.* from tradelog l , trade_detail d where d.tradeid=CONVERT(l.tradeid USING utf8) and l.id=2; 
</code></pre><p><img src=https://static001.geekbang.org/resource/image/aa/d6/aa844a7bf35d330b9ec96fc159331bd6.png alt></p><center>图7 SQL语句优化后的explain结果</center><p>这里，我主动把 l.tradeid转成utf8，就避免了被驱动表上的字符编码转换，从explain结果可以看到，这次索引走对了。</p><h1>小结</h1><p>今天我给你举了三个例子，其实是在说同一件事儿，即：<strong>对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。</strong></p><p>第二个例子是隐式类型转换，第三个例子是隐式字符编码转换，它们都跟第一个例子一样，因为要求在索引字段上做函数操作而导致了全索引扫描。</p><p>MySQL的优化器确实有“偷懒”的嫌疑，即使简单地把where id+1=1000改写成where id=1000-1就能够用上索引快速查找，也不会主动做这个语句重写。</p><p>因此，每次你的业务代码升级时，把可能出现的、新的SQL语句explain一下，是一个很好的习惯。</p><p>最后，又到了思考题时间。</p><p>今天我留给你的课后问题是，你遇到过别的、类似今天我们提到的性能问题吗？你认为原因是什么，又是怎么解决的呢？</p><p>你可以把你经历和分析写在留言区里，我会在下一篇文章的末尾选取有趣的评论跟大家一起分享和分析。感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><h1>上期问题时间</h1><p>我在上篇文章的最后，留给你的问题是：我们文章中最后的一个方案是，通过三次limit Y,1 来得到需要的数据，你觉得有没有进一步的优化方法。</p><p>这里我给出一种方法，取Y1、Y2和Y3里面最大的一个数，记为M，最小的一个数记为N，然后执行下面这条SQL语句：</p><pre><code>mysql&gt; select * from t limit N, M-N+1;
</code></pre><p>再加上取整个表总行数的C行，这个方案的扫描行数总共只需要C+M+1行。</p><p>当然也可以先取回id值，在应用中确定了三个id值以后，再执行三次where id=X的语句也是可以的。@倪大人 同学在评论区就提到了这个方法。</p><p>这次评论区出现了很多很棒的留言：</p><blockquote>
<p>@老杨同志 提出了重新整理的方法、@雪中鼠[悠闲] 提到了用rowid的方法，是类似的思路，就是让表里面保存一个无空洞的自增值，这样就可以用我们的随机算法1来实现；<br>
@吴宇晨 提到了拿到第一个值以后，用id迭代往下找的方案，利用了主键索引的有序性。</p></blockquote><p></p><style>ul{list-style:none;display:block;list-style-type:disc;margin-block-start:1em;margin-block-end:1em;margin-inline-start:0;margin-inline-end:0;padding-inline-start:40px}li{display:list-item;text-align:-webkit-match-parent}._2sjJGcOH_0{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-top:26px;border-bottom:1px solid rgba(233,233,233,.6)}._2sjJGcOH_0 ._3FLYR4bF_0{width:34px;height:34px;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}._2sjJGcOH_0 ._36ChpWj4_0{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;padding-bottom:20px}._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0{font-size:16px;color:#3d464d;font-weight:500;-webkit-font-smoothing:antialiased;line-height:34px}._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0{margin-top:12px;color:#505050;-webkit-font-smoothing:antialiased;font-size:14px;font-weight:400;white-space:normal;word-break:break-all;line-height:24px}._2sjJGcOH_0 ._10o3OAxT_0{margin-top:18px;border-radius:4px;background-color:#f6f7fb}._2sjJGcOH_0 ._3klNVc4Z_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:15px}._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0{color:#505050;-webkit-font-smoothing:antialiased;font-size:14px;font-weight:400;white-space:normal;word-break:break-word;padding:20px 20px 20px 24px}._2sjJGcOH_0 ._3klNVc4Z_0{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:15px}._2sjJGcOH_0 ._3Hkula0k_0{color:#b2b2b2;font-size:14px}</style><ul><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>老杨同志</span>
</div><div class=_2_QraFYR_0>感谢老师鼓励，我本人工作时间比较长，有一定的基础，听老师的课还是收获很大。每次公司内部有技术分享，我都去听课，但是多数情况，一两个小时的分享，就只有一两句话受益。老师的每篇文章都能命中我的知识盲点，感觉太别爽。<br><br>对应今天的隐式类型转换问题也踩过坑。<br>我们有个任务表记录待执行任务，表结构简化后如下：<br>CREATE TABLE `task` (<br> `task_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增主键',<br> `task_type` int(11) DEFAULT NULL COMMENT '任务类型id',<br> `task_rfid` varchar(50) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT '关联外键1',<br> PRIMARY KEY (`task_id`)<br>) ENGINE=InnoDB AUTO_INCREMENT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='任务表';<br><br>task_rfid 是业务主键，当然都是数字，查询时使用sql：<br>select * from task where task_rfid =123;<br>其实这个语句也有隐式转换问题，但是待执行任务只有几千条记录，并没有什么感觉。<br>这个表还有个对应的历史表，数据有几千万<br>忽然有一天，想查一下历史记录，执行语句<br>select * from task_history where task_rfid =99;<br>直接就等待很长时间后超时报错了。<br>如果仔细看，其实我的表没有task_rfid 索引，写成task_rfid =‘99’也一样是全表扫描。<br>运维时的套路是，猜测主键task_id的范围，怎么猜，我原表有creat_time字段，我会先查<br>select max(task_id) from task_history 然后再看看 select * from task_history where task_id = maxId - 10000的时间，估计出大概的id范围。然后语句变成<br>select * from task_history where task_rfid =99 and id between ？ and ？;<br></div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 你最后这个id预估，加上between ，<br>有种神来之笔的感觉😄<br>感觉隐约里面有二分法的思想<br>👍🏿</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 10:47:32</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICBNZjA9hW65x6g9b2iaicKUJW5gxFxtgPXH9Cqp6eyFfY1sD2hVY4dZrY5pmoK2r1KZEiaaIKocdZQ/132 class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>赖阿甘</span>
</div><div class=_2_QraFYR_0>“mysql>select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4;”<br>图6上面那句sql是不是写错了。d.tradeid=l.tradeid是不是该写成l.tradeid = d.tradeid？不然函数会作用在索引字段上，就只能全表扫描了</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 这个问题不是等号顺序决定的哈<br><br><br><br>好问题</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 13:48:20</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/0f/bc/8a/9420cf2a.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>冠超</span>
</div><div class=_2_QraFYR_0>非常感谢老师分享的内容，实打实地学到了。这里提个建议，希望老师能介绍一下设计表的时候要怎么考虑这方面的知识哈😊</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 是这样的，其实我们整个专栏大部分的文章，最后都是为了说明 “怎么设计表”、“怎么考虑优化SQL语句”<br><br>但是因为这个不是一成不变的，很多是需要考虑现实的情况，<br>所以这个专栏就是想把对应的原理说一下，这样大家在应对不同场景的时候，可以组合来考虑。<br><br>也就是说没有一段话可以把“怎么设计表”讲清楚（或者说硬写出来很可能就是一些general的没有什么针对性作用的描述）<br><br>你可以把你的业务背景抽象说下，我们来具体讨论吧</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-01-28 07:16:49</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/13/c7/a1/273bff58.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>可凡不凡</span>
</div><div class=_2_QraFYR_0>1.老师好<br>2.如果在用一个 MySQL 关键字做字段,并且字段上索引,当我用这个索引作为唯一查询条件的时候 ,会 造 成隐式的转换吗? <br>例如:SELECT * FROM b_side_order WHERE CODE = 332924 ; (code 上有索引)<br>3. mysql5.6 code 上有索引 intime 上没有索引<br>语句一:<br>SELECT * FROM b_side_order WHERE CODE = 332924 ;<br>语句二;<br> UPDATE b_side_order SET in_time = '2018-08-04 08:34:44' WHERE 1=2 or CODE = 332924;<br><br>这两个语句 执行计划走 select 走了索引,update 没有走索引 是执行计划的bug 吗??<br><br> <br><br><br></div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 1. 你好😄<br>2. CODE不是关键字呀， 另外优化器选择跟关键字无关哈，关键字的话，要用 反‘ 括起来<br>3. 不是bug, update如果把 or 改成 and , 就能走索引😄</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-25 09:10:31</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>700</span>
</div><div class=_2_QraFYR_0>老师您好，有个问题恳请指教。背景如下，我长话短说：<br><br>mysql>select @@version;<br>5.6.30-log<br><br> CREATE TABLE `t1` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT,<br> `user_id` int(11) NOT NULL, `plan_id` int(11) NOT NULL DEFAULT '0' , PRIMARY KEY (`id`),<br> KEY `userid` (`user_id`) USING BTREE, KEY `idx_planid` (`plan_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=gb2312;<br><br> CREATE TABLE `t3` (<br> `id` int(11) NOT NULL AUTO_INCREMENT,<br> `status` int(4) NOT NULL DEFAULT '0',<br> `ootime` varchar(11) DEFAULT NULL,<br> PRIMARY KEY (`id`),<br> KEY `idx_xxoo` (`status`,`ootime`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br><br>t1 和 t3 表的字符集不一样<br><br>sql 执行计划如下：<br>explain<br>SELECT t1.id, t1.user_id<br> FROM t1, t3<br> WHERE t1.plan_id = t3.id<br> AND t3.ootime &lt; UNIX_TIMESTAMP('2022-01-18')<br>+----+-------------+-------+-------+---------------+--------------+---------+--------------+-------+----------------------------------------+<br>| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |<br>+----+-------------+-------+-------+---------------+--------------+---------+--------------+-------+----------------------------------------+<br>| 1 | SIMPLE | t3 | index | PRIMARY | idx_xxoo | 51 | NULL | 39106 | Using where; Using index |<br>| 1 | SIMPLE | t1 | ref | idx_planid | idx_planid | 4 | t3.id | 401 | Using join buffer (Batched Key Access) |<br>+----+-------------+-------+-------+---------------+--------------+---------+--------------+-------+----------------------------------------+<br><br>我的疑惑是<br>1)t3 的 status 没出现在 where 条件中，但执行计划为什么用到了 idex_xxoo 索引？<br>2)为什么 t3.ootime 也用到索引了，从 key_len 看出。t3.ootime 是 varchar 类型的，而 UNIX_TIMESTAMP('2022-01-18') 是数值，不是发生了隐式转换吗？<br><br>请老师指点。<br></div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 这个查询语句会对t3做全索引扫描，是使用了索引的，只是没有用上快速搜索功能</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-01-18 19:12:01</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>探索无止境</span>
</div><div class=_2_QraFYR_0>老师，有道面试题困扰了很久，求指教！题目是这样的，a表有100条记录，b表有10000条记录，两张表做关联查询时，是将a表放前面效率高，还是b表放前面效率高？网上各种答案，但感觉都没有十分的说服力，期待老师的指点！</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: (这题目改成100万禾10000万比较好)<br>如果是考察语句写法，这两个表谁放前面都一样，优化器会调整顺序选择合适的驱动表；<br><br>如果是考察优化器怎么实现的，你可以这么想，每次在树搜索里面做一次查找都是log(n), 所以对比的是100*log(10000)和 10000*log(100)哪个小，显然是前者，所以结论应该是让小表驱动大表。</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-01-13 11:44:49</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>Leon📷</span>
</div><div class=_2_QraFYR_0>索引字段不能进行函数操作，但是索引字段的参数可以玩函数，一言以蔽之</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 精辟😄</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 10:42:28</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>某、人</span>
</div><div class=_2_QraFYR_0>SQL逻辑相同,性能差异较大的,通过老师所讲学习到的,和平时碰到的,大概有以下几类:<br>一.字段发生了转换,导致本该使用索引而没有用到索引<br>1.条件字段函数操作<br>2.隐式类型转换<br>3.隐式字符编码转换<br>(如果驱动表的字符集比被驱动表得字符集小，关联列就能用到索引,如果更大,需要发生隐式编码转换,则不能用到索引,latin&lt;gbk&lt;utf8&lt;utf8mb4)<br><br>二.嵌套循环,驱动表与被驱动表选择错误<br>1.连接列上没有索引,导致大表驱动小表,或者小表驱动大表(但是大表走的是全表扫描) --连接列上建立索引<br>2.连接列上虽然有索引,但是驱动表任然选择错误。--通过straight_join强制选择关联表顺序<br>3.子查询导致先执行外表在执行子查询,也是驱动表与被驱动表选择错误。 <br>--可以考虑把子查询改写为内连接,或者改写内联视图(子查询放在from后组成一个临时表,在于其他表进行关联)<br>4.只需要内连接的语句,但是写成了左连接或者右连接。比如select * from t left join b on t.id=b.id where b.name='abc'驱动表被固定,大概率会扫描更多的行,导致效率降低. <br> --根据业务情况或sql情况,把左连接或者右连接改写为内连接<br><br>三.索引选择不同,造成性能差异较大<br>1.select * from t where aid= and create_name>'' order by id limit 1;<br>选择走id索引或者选择走(aid,create_time)索引,性能差异较大.结果集都有可能不一致<br>--这个可以通过where条件过滤的值多少来大概判断,该走哪个索引<br><br>四.其它一些因素<br>1.比如之前学习到的是否有MDL X锁<br>2.innodb_buffer_pool设置得太小,innodb_io_capacity设置得太小,刷脏速度跟不上<br>3.是否是对表做了DML语句之后,马上做select,导致change buffer收益不高<br>4.是否有数据空洞<br>5.select选取的数据是否在buffer_pool中<br>6.硬件原因,资源抢占<br>原因多种多样,还需要慢慢补充。<br><br>老师我问一个问题:<br>连接列上一个是int一个是bigint或者一个是char一个varchar,为什么被驱动表上会出现(using index condition)?</div><div class=_10o3OAxT_0>
</div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 16:21:24</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>乔纳森</span>
</div><div class=_2_QraFYR_0>执行explain 语句后，使用show warnings; 可以看到MySQL 实际执行的SQL，包括字符集的转换</div><div class=_10o3OAxT_0>
</div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-05-04 17:07:08</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/12/18/34/c082419c.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>风轨</span>
</div><div class=_2_QraFYR_0>刚试了文中穿插得思考题:当主键是整数类型条件是字符串时，会走索引。<br>文中提到了当字符串和数字比较时会把字符串转化为数字，所以隐式转换不会应用到字段上，所以可以走索引。<br>另外，select 'a' = 0 ; 的结果是1，说明无法转换成数字的字符串都被转换成0来处理了。</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 👍🏿</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 09:54:29</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/11/03/a2/ceb37046.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>crazyone</span>
</div><div class=_2_QraFYR_0>老师你好，我在执行explain的时候，发现extra 里面 有using where，using index ，using index condition 能具体讲下这几个的区别吗？</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: Using index是覆盖索引<br>Using index condition 是索引下推</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-26 17:11:56</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/14/16/77/73bd9d18.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>匿名的朋友</span>
</div><div class=_2_QraFYR_0>丁奇老师，我有个疑问，就是sql语句执行时那些order by group by limit 以及where条件，有执行的先后顺序吗？</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 有，先where ,再order by 最后limit </p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-01-05 17:34:03</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>饭粒</span>
</div><div class=_2_QraFYR_0>感觉要使用索引就不能“破坏”索引原有的顺序，这节的函数操作，隐式转换都“破坏”了原有的顺序。前一节的select * from t where city in in (“杭州”," 苏州 ") order by name limit 100; 同样是破坏了 (city,name) 联合索引的递增顺序，类似的还有使用联合索引，一个字段DESC，一个ASC。</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 👍 总结得很好<br><br>“顺势而查”才能用上索引😆</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-02-25 23:22:12</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132 class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>涛哥哥</span>
</div><div class=_2_QraFYR_0>老师，您好！我是做后端开发的。想问一下 mysql in关键字 的内部原理，能抽一点点篇幅讲一下吗？比如：select * from T where id in (a,b,d,c,,e,f); id是主键。1、为什么查询出来的结果集会按照id排一次序呢（是跟去重有关系么）？2、如果 in 里面的值较多的时候，就会比较慢啊（是还不如全表扫描么）？问我们公司很多后端的，都不太清楚，问我们DBA，他说默认就是这样（这不跟没说一样吗）。希望老师可以帮忙解惑。祝老师身体健康！微笑~</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 1. 优化器会排个序，目的是如果这几个记录对应的数据都不在内存里，可以触发顺序读盘，后面文章我们介绍到join的时候，会提到MRR，你关注下<br><br>2. in里面值多就是多次执行树搜索，跟全表扫描的速度对比，就看in里面的数据个数的比例了。 你的in里面一般多少个value呀</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-01-26 15:53:27</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/0f/67/29/b0ec5430.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>greatcl</span>
</div><div class=_2_QraFYR_0>刚刚帮一个同事看SQL慢的问题，帮他找出来问题，并拿出这篇文章让他看，哈哈</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 👍 这个感觉太赞啦</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2019-05-22 11:38:20</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/13/c7/a1/273bff58.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>可凡不凡</span>
</div><div class=_2_QraFYR_0>1.老师对于多表联合查询中,MySQL 对索引的选择 以后会详细介绍吗?<br></div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 额，你是第三个提这个问题的了，我得好好考虑下安排😄</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 13:49:14</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>探索无止境</span>
</div><div class=_2_QraFYR_0>多表连接时，mysql是怎么选择驱动表和被驱动表的？这个很重要，希望老师可以讲讲</div><div class=_10o3OAxT_0>
</div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-25 08:49:04</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/13/ed/a5/ca3b4cc4.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>Wrelon</span>
</div><div class=_2_QraFYR_0>在第10章的时候提问过一次，当时表述的不够清楚，现在知道了，应该是因为隐式类型转换导致了全索引扫描。这个课程真实太棒了，我踩过的坑都说了。</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 👍🏿 对大家有帮助我最开心啦😄</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-25 21:29:12</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>TKbook</span>
</div><div class=_2_QraFYR_0>老师，对于最后回答上一课的问题：mysql> select * from t limit N, M-N+1;<br>这个语句也不是取3条记录。 没理解。</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 取其中三条…</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-27 17:44:00</div></div></div></div></li><li>
<div class=_2sjJGcOH_0><img src=https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg class=_3FLYR4bF_0>
<div class=_36ChpWj4_0>
<div class=_2zFoi7sd_0><span>书策稠浊</span>
</div><div class=_2_QraFYR_0>上期问题答案是取三个数，但是这里貌似不是三个数，不理解。</div><div class=_10o3OAxT_0>
<p class=_3KxQPN3V_0>作者回复: 取回来以后再挑那三个呀😄</p></div><div class=_3klNVc4Z_0>
<div class=_3Hkula0k_0>2018-12-24 23:47:28</div></div></div></div></li></ul><footer class=footline>
</footer></div></div><div id=navigation>
<a class="nav nav-prev" href=/1/17/ title=17_如何正确地显示随机消息？> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/1/19/ title=19_为什么我只查一行的语句，也执行这么慢？ style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1646789669></script>
<script src=/js/perfect-scrollbar.min.js?1646789669></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1646789669></script>
<script src=/js/jquery.sticky.js?1646789669></script>
<script src=/js/featherlight.min.js?1646789669></script>
<script src=/js/highlight.pack.js?1646789669></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=/js/modernizr.custom-3.6.0.js?1646789669></script>
<script src=/js/learn.js?1646789669></script>
<script src=/js/hugo-learn.js?1646789669></script>
<script src=/mermaid/mermaid.js?1646789669></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
</body></html>