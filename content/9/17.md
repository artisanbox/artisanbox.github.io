---
title: "17_åˆ’åˆ†åœŸåœ°ï¼ˆä¸­ï¼‰ï¼šå¦‚ä½•å®ç°å†…å­˜é¡µé¢åˆå§‹åŒ–ï¼Ÿ"
date: 2022-03-08T18:37:53+08:00
draft: false
---
<audio title="17 _ åˆ’åˆ†åœŸåœ°ï¼ˆä¸­ï¼‰ï¼šå¦‚ä½•å®ç°å†…å­˜é¡µé¢åˆå§‹åŒ–ï¼Ÿ" src="https://static001.geekbang.org/resource/audio/d0/10/d088df1d010d96aca47c37649910e610.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚</p><p>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬ç¡®å®šäº†ç”¨åˆ†é¡µæ–¹å¼ç®¡ç†å†…å­˜ï¼Œå¹¶ä¸”ä¸€èµ·åŠ¨æ‰‹è®¾è®¡äº†è¡¨ç¤ºå†…å­˜é¡µã€å†…å­˜åŒºç›¸å…³çš„å†…å­˜ç®¡ç†æ•°æ®ç»“æ„ã€‚ä¸è¿‡ï¼Œè™½ç„¶å†…å­˜ç®¡ç†ç›¸å…³çš„æ•°æ®ç»“æ„å·²ç»å®šä¹‰å¥½äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­å»ºç«‹å¯¹åº”çš„<strong>å®ä¾‹å˜é‡</strong>ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨ä»£ç ä¸­å®é™…æ“ä½œçš„æ•°æ®ç»“æ„å¿…é¡»åœ¨å†…å­˜ä¸­æœ‰ç›¸åº”çš„å˜é‡ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬å°±å»å»ºç«‹å¯¹åº”çš„å®ä¾‹å˜é‡ï¼Œå¹¶åˆå§‹åŒ–å®ƒä»¬ã€‚</p><h2>åˆå§‹åŒ–</h2><p>å‰é¢çš„è¯¾é‡Œï¼Œæˆ‘ä»¬åœ¨halå±‚åˆå§‹åŒ–ä¸­ï¼Œåˆå§‹åŒ–äº†ä»äºŒçº§å¼•å¯¼å™¨ä¸­è·å–çš„å†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ª<strong>e820map_tæ•°ç»„</strong>ï¼Œå¹¶æŠŠè¿™ä¸ªæ•°ç»„è½¬æ¢æˆäº†phymmarge_tç»“æ„æ•°ç»„ï¼Œè¿˜å¯¹å®ƒåšäº†æ’åºã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬Cosmosç‰©ç†å†…å­˜ç®¡ç†å™¨å‰©ä¸‹çš„éƒ¨åˆ†è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ï¼Œä¸‹é¢æˆ‘ä»¬å°±å»å®ç°å®ƒã€‚</p><p>Cosmosçš„ç‰©ç†å†…å­˜ç®¡ç†å™¨ï¼Œæˆ‘ä»¬ä¾ç„¶è¦æ”¾åœ¨Cosmosçš„halå±‚ã€‚</p><p>å› ä¸ºç‰©ç†å†…å­˜è¿˜å’Œç¡¬ä»¶å¹³å°ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨cosmos/hal/x86/ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªmemmgrinit.cæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªCosmosç‰©ç†å†…å­˜ç®¡ç†å™¨åˆå§‹åŒ–çš„å¤§æ€»ç®¡â€”â€”init_memmgrå‡½æ•°ï¼Œå¹¶åœ¨init_halmmå‡½æ•°ä¸­è°ƒç”¨å®ƒï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>//cosmos/hal/x86/halmm.cä¸­
//halå±‚çš„å†…å­˜åˆå§‹åŒ–å‡½æ•°
void init_halmm()
{
    init_phymmarge();
    init_memmgr();
    return;
}
//Cosmosç‰©ç†å†…å­˜ç®¡ç†å™¨åˆå§‹åŒ–
void init_memmgr()
{
    //åˆå§‹åŒ–å†…å­˜é¡µç»“æ„msadsc_t
    //åˆå§‹åŒ–å†…å­˜åŒºç»“æ„memarea_t
    return;
}
</code></pre><p>æ ¹æ®å‰é¢æˆ‘ä»¬å¯¹å†…å­˜ç®¡ç†ç›¸å…³æ•°æ®ç»“æ„çš„è®¾è®¡ï¼Œä½ åº”è¯¥ä¸éš¾æƒ³åˆ°ï¼Œåœ¨init_memmgrå‡½æ•°ä¸­åº”è¯¥è¦å®Œæˆ<strong>å†…å­˜é¡µç»“æ„msadsc_tå’Œå†…å­˜åŒºç»“æ„memarea_tçš„åˆå§‹åŒ–</strong>ï¼Œä¸‹é¢å°±åˆ†åˆ«æå®šè¿™ä¸¤ä»¶äº‹ã€‚</p><!-- [[[read_end]]] --><h3>å†…å­˜é¡µç»“æ„åˆå§‹åŒ–</h3><p>å†…å­˜é¡µç»“æ„çš„åˆå§‹åŒ–ï¼Œå…¶å®å°±æ˜¯åˆå§‹åŒ–msadsc_tç»“æ„å¯¹åº”çš„å˜é‡ã€‚å› ä¸ºä¸€ä¸ªmsadsc_tç»“æ„ä½“å˜é‡ä»£è¡¨ä¸€ä¸ªç‰©ç†å†…å­˜é¡µï¼Œè€Œç‰©ç†å†…å­˜ç”±å¤šä¸ªé¡µç»„æˆï¼Œæ‰€ä»¥æœ€ç»ˆä¼šå½¢æˆä¸€ä¸ªmsadsc_tç»“æ„ä½“æ•°ç»„ã€‚</p><p>è¿™ä¼šè®©æˆ‘ä»¬çš„å·¥ä½œå˜å¾—ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä½œä¸ºmsadsc_tç»“æ„ä½“æ•°ç»„çš„å¼€å§‹åœ°å€ï¼Œå½“ç„¶è¿™ä¸ªå†…å­˜åœ°å€å¿…é¡»æ˜¯å¯ç”¨çš„ï¼Œè€Œä¸”ä¹‹åå†…å­˜ç©ºé—´è¶³ä»¥å­˜æ”¾msadsc_tç»“æ„ä½“æ•°ç»„ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬è¦æ‰«æphymmarge_tç»“æ„ä½“æ•°ç»„ä¸­çš„ä¿¡æ¯ï¼Œåªè¦å®ƒçš„ç±»å‹æ˜¯å¯ç”¨å†…å­˜ï¼Œå°±å»ºç«‹ä¸€ä¸ªmsadsc_tç»“æ„ä½“ï¼Œå¹¶æŠŠå…¶ä¸­çš„å¼€å§‹åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªé¡µé¢åœ°å€ã€‚</p><p>æ¥ç€ï¼Œè¦ç»™è¿™ä¸ªå¼€å§‹åœ°å€åŠ ä¸Š0x1000ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°å…¶ç»“æŸåœ°å€ã€‚</p><p>å½“è¿™ä¸ªphymmarge_tç»“æ„ä½“çš„åœ°å€åŒºé—´ï¼Œå®ƒå¯¹åº”çš„æ‰€æœ‰msadsc_tç»“æ„ä½“éƒ½å»ºç«‹å®Œæˆä¹‹åï¼Œå°±å¼€å§‹ä¸‹ä¸€ä¸ªphymmarge_tç»“æ„ä½“ã€‚ä¾æ¬¡ç±»æ¨ï¼Œæœ€åï¼Œæˆ‘ä»¬å°±èƒ½å»ºå¥½æ‰€æœ‰å¯ç”¨ç‰©ç†å†…å­˜é¡µé¢å¯¹åº”çš„msadsc_tç»“æ„ä½“ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å»cosmos/hal/x86/ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªmsadsc.cæ–‡ä»¶ã€‚åœ¨è¿™é‡Œå†™ä¸‹å®Œæˆè¿™äº›åŠŸèƒ½çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>void write_one_msadsc(msadsc_t *msap, u64_t phyadr)
{
    //å¯¹msadsc_tç»“æ„åšåŸºæœ¬çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚é“¾è¡¨ã€é”ã€æ ‡å¿—ä½
    msadsc_t_init(msap);
    //è¿™æ˜¯æŠŠä¸€ä¸ª64ä½çš„å˜é‡åœ°å€è½¬æ¢æˆphyadrflgs_t*ç±»å‹æ–¹ä¾¿å–å¾—å…¶ä¸­çš„åœ°å€ä½æ®µ
    phyadrflgs_t *tmp = (phyadrflgs_t *)(&amp;phyadr);
    //æŠŠé¡µçš„ç‰©ç†åœ°å€å†™å…¥åˆ°msadsc_tç»“æ„ä¸­
    msap-&gt;md_phyadrs.paf_padrs = tmp-&gt;paf_padrs;
    return;
}

u64_t init_msadsc_core(machbstart_t *mbsp, msadsc_t *msavstart, u64_t msanr)
{
    //è·å–phymmarge_tç»“æ„æ•°ç»„å¼€å§‹åœ°å€
    phymmarge_t *pmagep = (phymmarge_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_e820expadr);
    u64_t mdindx = 0;
    //æ‰«æphymmarge_tç»“æ„æ•°ç»„
    for (u64_t i = 0; i &lt; mbsp-&gt;mb_e820exnr; i++)
    {
        //åˆ¤æ–­phymmarge_tç»“æ„çš„ç±»å‹æ˜¯ä¸æ˜¯å¯ç”¨å†…å­˜
        if (PMR_T_OSAPUSERRAM == pmagep[i].pmr_type)
        {
            //éå†phymmarge_tç»“æ„çš„åœ°å€åŒºé—´
            for (u64_t start = pmagep[i].pmr_saddr; start &lt; pmagep[i].pmr_end; start += 4096)
            {
                //æ¯æ¬¡åŠ ä¸Š4KB-1æ¯”è¾ƒæ˜¯å¦å°äºç­‰äºphymmarge_tç»“æ„çš„ç»“æŸåœ°å€
                if ((start + 4096 - 1) &lt;= pmagep[i].pmr_end)
                {
                    //ä¸å½“å‰åœ°å€ä¸ºå‚æ•°å†™å…¥ç¬¬mdindxä¸ªmsadscç»“æ„
                    write_one_msadsc(&amp;msavstart[mdindx], start);
                    mdindx++;
                }
            }
        }
    }
    return mdindx;
}

void init_msadsc()
{
    u64_t coremdnr = 0, msadscnr = 0;
    msadsc_t *msadscvp = NULL;
    machbstart_t *mbsp = &amp;kmachbsp;
    //è®¡ç®—msadsc_tç»“æ„æ•°ç»„çš„å¼€å§‹åœ°å€å’Œæ•°ç»„å…ƒç´ ä¸ªæ•°
    if (ret_msadsc_vadrandsz(mbsp, &amp;msadscvp, &amp;msadscnr) == FALSE)
    {
        system_error(&quot;init_msadsc ret_msadsc_vadrandsz err\n&quot;);
    }
    //å¼€å§‹çœŸæ­£åˆå§‹åŒ–msadsc_tç»“æ„æ•°ç»„
    coremdnr = init_msadsc_core(mbsp, msadscvp, msadscnr);
    if (coremdnr != msadscnr)
    {
        system_error(&quot;init_msadsc init_msadsc_core err\n&quot;);
    }
    //å°†msadsc_tç»“æ„æ•°ç»„çš„å¼€å§‹çš„ç‰©ç†åœ°å€å†™å…¥kmachbspç»“æ„ä¸­ 
    mbsp-&gt;mb_memmappadr = viradr_to_phyadr((adr_t)msadscvp);
    //å°†msadsc_tç»“æ„æ•°ç»„çš„å…ƒç´ ä¸ªæ•°å†™å…¥kmachbspç»“æ„ä¸­ 
    mbsp-&gt;mb_memmapnr = coremdnr;
    //å°†msadsc_tç»“æ„æ•°ç»„çš„å¤§å°å†™å…¥kmachbspç»“æ„ä¸­ 
    mbsp-&gt;mb_memmapsz = coremdnr * sizeof(msadsc_t);
    //è®¡ç®—ä¸‹ä¸€ä¸ªç©ºé—²å†…å­˜çš„å¼€å§‹åœ°å€ 
    mbsp-&gt;mb_nextwtpadr = PAGE_ALIGN(mbsp-&gt;mb_memmappadr + mbsp-&gt;mb_memmapsz);
    return;
}
</code></pre><p>ä¸Šé¢çš„ä»£ç é‡å¾ˆå°‘ï¼Œé€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå†é…åˆæ³¨é‡Šï¼Œç›¸ä¿¡ä½ çœ‹å¾—æ‡‚ã€‚å…¶ä¸­çš„ret_msadsc_vadrandszå‡½æ•°ä¹Ÿæ˜¯éå†phymmarge_tç»“æ„æ•°ç»„ï¼Œè®¡ç®—å‡ºæœ‰å¤šå¤§çš„å¯ç”¨å†…å­˜ç©ºé—´ï¼Œå¯ä»¥åˆ†æˆå¤šå°‘ä¸ªé¡µé¢ï¼Œéœ€è¦å¤šå°‘ä¸ªmsadsc_tç»“æ„ã€‚</p><h3>å†…å­˜åŒºç»“æ„åˆå§‹åŒ–</h3><p>å‰é¢æˆ‘ä»¬å°†æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´åœ¨é€»è¾‘ä¸Šåˆ†æˆäº†ä¸‰ä¸ªåŒºï¼Œåˆ†åˆ«æ˜¯<strong>ï¼šç¡¬ä»¶åŒºã€å†…æ ¸åŒºã€ç”¨æˆ·åŒº</strong>ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬è¦åœ¨å†…å­˜ä¸­å»ºç«‹ä¸‰ä¸ªmemarea_tç»“æ„ä½“çš„å®ä¾‹å˜é‡ã€‚</p><p>å°±åƒå»ºç«‹msadsc_tç»“æ„æ•°ç»„ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å†…å­˜ä¸­æ‰¾ä¸ªç©ºé—²ç©ºé—´ï¼Œå­˜æ”¾è¿™ä¸‰ä¸ªmemarea_tç»“æ„ä½“å°±è¡Œã€‚ç›¸æ¯”å»ºç«‹msadsc_tç»“æ„æ•°ç»„è¿™æ›´ä¸ºç®€å•ï¼Œå› ä¸ºmemarea_tç»“æ„ä½“æ˜¯é¡¶å±‚ç»“æ„ï¼Œå¹¶ä¸ä¾èµ–å…¶å®ƒæ•°æ®ç»“æ„ï¼Œåªæ˜¯å¯¹å…¶æœ¬èº«è¿›è¡Œåˆå§‹åŒ–å°±å¥½äº†ã€‚</p><p>ä½†æ˜¯ç”±äºå®ƒè‡ªèº«åŒ…å«äº†å…¶å®ƒæ•°æ®ç»“æ„ï¼Œåœ¨åˆå§‹åŒ–å®ƒæ—¶ï¼Œè¦å¯¹å…¶ä¸­çš„å…¶å®ƒæ•°æ®ç»“æ„è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥è¦å°å¿ƒä¸€äº›ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å»cosmos/hal/x86/ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªmemarea.cæ–‡ä»¶ï¼Œå†™ä¸‹å®Œæˆè¿™äº›åŠŸèƒ½çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>void bafhlst_t_init(bafhlst_t *initp, u32_t stus, uint_t oder, uint_t oderpnr)
{
    //åˆå§‹åŒ–bafhlst_tç»“æ„ä½“çš„åŸºæœ¬æ•°æ®
    knl_spinlock_init(&amp;initp-&gt;af_lock);
    initp-&gt;af_stus = stus;
    initp-&gt;af_oder = oder;
    initp-&gt;af_oderpnr = oderpnr;
    initp-&gt;af_fobjnr = 0;
    initp-&gt;af_mobjnr = 0;
    initp-&gt;af_alcindx = 0;
    initp-&gt;af_freindx = 0;
    list_init(&amp;initp-&gt;af_frelst);
    list_init(&amp;initp-&gt;af_alclst);
    list_init(&amp;initp-&gt;af_ovelst);
    return;
}

void memdivmer_t_init(memdivmer_t *initp)
{
    //åˆå§‹åŒ–medivmer_tç»“æ„ä½“çš„åŸºæœ¬æ•°æ®
    knl_spinlock_init(&amp;initp-&gt;dm_lock);
    initp-&gt;dm_stus = 0;
    initp-&gt;dm_divnr = 0;
    initp-&gt;dm_mernr = 0;
    //å¾ªç¯åˆå§‹åŒ–memdivmer_tç»“æ„ä½“ä¸­dm_mdmlielstæ•°ç»„ä¸­çš„æ¯ä¸ªbafhlst_tç»“æ„çš„åŸºæœ¬æ•°æ®
    for (uint_t li = 0; li &lt; MDIVMER_ARR_LMAX; li++)
    {
        bafhlst_t_init(&amp;initp-&gt;dm_mdmlielst[li], BAFH_STUS_DIVM, li, (1UL &lt;&lt; li));
    }
    bafhlst_t_init(&amp;initp-&gt;dm_onemsalst, BAFH_STUS_ONEM, 0, 1UL);
    return;
}

void memarea_t_init(memarea_t *initp)
{
    //åˆå§‹åŒ–memarea_tç»“æ„ä½“çš„åŸºæœ¬æ•°æ®
    list_init(&amp;initp-&gt;ma_list);
    knl_spinlock_init(&amp;initp-&gt;ma_lock);
    initp-&gt;ma_stus = 0;
    initp-&gt;ma_flgs = 0;
    initp-&gt;ma_type = MA_TYPE_INIT;
    initp-&gt;ma_maxpages = 0;
    initp-&gt;ma_allocpages = 0;
    initp-&gt;ma_freepages = 0;
    initp-&gt;ma_resvpages = 0;
    initp-&gt;ma_horizline = 0;
    initp-&gt;ma_logicstart = 0;
    initp-&gt;ma_logicend = 0;
    initp-&gt;ma_logicsz = 0;
    //åˆå§‹åŒ–memarea_tç»“æ„ä½“ä¸­çš„memdivmer_tç»“æ„ä½“
    memdivmer_t_init(&amp;initp-&gt;ma_mdmdata);
    initp-&gt;ma_privp = NULL;
    return;
}

bool_t init_memarea_core(machbstart_t *mbsp)
{
    //è·å–memarea_tç»“æ„å¼€å§‹åœ°å€
    u64_t phymarea = mbsp-&gt;mb_nextwtpadr;
    //æ£€æŸ¥å†…å­˜ç©ºé—´å¤Ÿä¸å¤Ÿæ”¾ä¸‹MEMAREA_MAXä¸ªmemarea_tç»“æ„å®ä¾‹å˜é‡
    if (initchkadr_is_ok(mbsp, phymarea, (sizeof(memarea_t) * MEMAREA_MAX)) != 0)
    {
        return FALSE;
    }
    memarea_t *virmarea = (memarea_t *)phyadr_to_viradr((adr_t)phymarea);
    for (uint_t mai = 0; mai &lt; MEMAREA_MAX; mai++)
    {   //å¾ªç¯åˆå§‹åŒ–æ¯ä¸ªmemarea_tç»“æ„å®ä¾‹å˜é‡
        memarea_t_init(&amp;virmarea[mai]);
    }
    //è®¾ç½®ç¡¬ä»¶åŒºçš„ç±»å‹å’Œç©ºé—´å¤§å°
    virmarea[0].ma_type = MA_TYPE_HWAD;
    virmarea[0].ma_logicstart = MA_HWAD_LSTART;
    virmarea[0].ma_logicend = MA_HWAD_LEND;
    virmarea[0].ma_logicsz = MA_HWAD_LSZ;
    //è®¾ç½®å†…æ ¸åŒºçš„ç±»å‹å’Œç©ºé—´å¤§å°
    virmarea[1].ma_type = MA_TYPE_KRNL;
    virmarea[1].ma_logicstart = MA_KRNL_LSTART;
    virmarea[1].ma_logicend = MA_KRNL_LEND;
    virmarea[1].ma_logicsz = MA_KRNL_LSZ;
    //è®¾ç½®åº”ç”¨åŒºçš„ç±»å‹å’Œç©ºé—´å¤§å°
    virmarea[2].ma_type = MA_TYPE_PROC;
    virmarea[2].ma_logicstart = MA_PROC_LSTART;
    virmarea[2].ma_logicend = MA_PROC_LEND;
    virmarea[2].ma_logicsz = MA_PROC_LSZ;
    //å°†memarea_tç»“æ„çš„å¼€å§‹çš„ç‰©ç†åœ°å€å†™å…¥kmachbspç»“æ„ä¸­ 
    mbsp-&gt;mb_memznpadr = phymarea;
    //å°†memarea_tç»“æ„çš„ä¸ªæ•°å†™å…¥kmachbspç»“æ„ä¸­ 
    mbsp-&gt;mb_memznnr = MEMAREA_MAX;
    //å°†æ‰€æœ‰memarea_tç»“æ„çš„å¤§å°å†™å…¥kmachbspç»“æ„ä¸­ 
    mbsp-&gt;mb_memznsz = sizeof(memarea_t) * MEMAREA_MAX;
    //è®¡ç®—ä¸‹ä¸€ä¸ªç©ºé—²å†…å­˜çš„å¼€å§‹åœ°å€ 
    mbsp-&gt;mb_nextwtpadr = PAGE_ALIGN(phymarea + sizeof(memarea_t) * MEMAREA_MAX);
    return TRUE;
}
//åˆå§‹åŒ–å†…å­˜åŒº
void init_memarea()
{
    //çœŸæ­£åˆå§‹åŒ–å†…å­˜åŒº
    if (init_memarea_core(&amp;kmachbsp) == FALSE)
    {
        system_error(&quot;init_memarea_core fail&quot;);
    }
    return;
}
</code></pre><p>ç”±äºè¿™äº›æ•°æ®ç»“æ„å¾ˆå¤§ï¼Œæ‰€ä»¥ä»£ç æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯é‡è¦çš„ä»£ç æˆ‘éƒ½åšäº†è¯¦ç»†æ³¨é‡Šã€‚</p><p>åœ¨init_memarea_coreå‡½æ•°çš„å¼€å§‹ï¼Œæˆ‘ä»¬è°ƒç”¨äº†memarea_t_initå‡½æ•°ï¼Œå¯¹MEMAREA_MAXä¸ªmemarea_tç»“æ„è¿›è¡Œäº†åŸºæœ¬çš„åˆå§‹åŒ–ã€‚</p><p>ç„¶åï¼Œåœ¨memarea_t_initå‡½æ•°ä¸­åˆè°ƒç”¨äº†memdivmer_t_initå‡½æ•°ï¼Œè€Œåœ¨memdivmer_t_initå‡½æ•°ä¸­åˆè°ƒç”¨äº†bafhlst_t_initå‡½æ•°ï¼Œè¿™ä¿è¯äº†é‚£äº›è¢«åŒ…å«çš„æ•°æ®ç»“æ„å¾—åˆ°äº†åˆå§‹åŒ–ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ç»™ä¸‰ä¸ªåŒºåˆ†åˆ«è®¾ç½®äº†ç±»å‹å’Œåœ°å€ç©ºé—´ã€‚</p><h3>å¤„ç†åˆå§‹å†…å­˜å ç”¨é—®é¢˜</h3><p>æˆ‘ä»¬åˆå§‹åŒ–äº†å†…å­˜é¡µå’Œå†…å­˜åŒºå¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œå·²ç»å¯ä»¥ç»„ç»‡å¥½å†…å­˜é¡µé¢äº†ã€‚ç°åœ¨çœ‹ä¼¼å·²ç»ä¸‡äº‹ä¿±å¤‡äº†ï¼Œå…¶å®è¿™æœ‰ä¸ªé‡å¤§çš„é—®é¢˜ï¼Œä½ çŸ¥é“æ˜¯ä»€ä¹ˆå—ï¼Ÿæˆ‘ç»™ä½ åˆ†æä¸€ä¸‹ã€‚</p><p>ç›®å‰æˆ‘ä»¬çš„å†…å­˜ä¸­å·²ç»æœ‰å¾ˆå¤šæ•°æ®äº†ï¼Œæœ‰Cosmoså†…æ ¸æœ¬èº«çš„æ‰§è¡Œæ–‡ä»¶ï¼Œæœ‰å­—ä½“æ–‡ä»¶ï¼Œæœ‰MMUé¡µè¡¨ï¼Œæœ‰æ‰“åŒ…çš„å†…æ ¸æ˜ åƒæ–‡ä»¶ï¼Œè¿˜æœ‰åˆšåˆšå»ºç«‹çš„å†…å­˜é¡µå’Œå†…å­˜åŒºçš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®éƒ½è¦å ç”¨å®é™…çš„ç‰©ç†å†…å­˜ã€‚</p><p>å†å›å¤´çœ‹çœ‹æˆ‘ä»¬å»ºç«‹å†…å­˜é¡µç»“æ„msadsc_tï¼Œæ‰€æœ‰çš„éƒ½æ˜¯ç©ºé—²çŠ¶æ€ï¼Œè€Œå®ƒä»¬æ¯ä¸€ä¸ªéƒ½è¡¨ç¤ºä¸€ä¸ªå®é™…çš„ç‰©ç†å†…å­˜é¡µã€‚</p><p>å‡å¦‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è°ƒç”¨å†…å­˜åˆ†é…æ¥å£è¿›è¡Œå†…å­˜åˆ†é…ï¼Œ<strong>å®ƒæŒ‰æ—¢å®šçš„åˆ†é…ç®—æ³•æŸ¥æ‰¾ç©ºé—²çš„msadsc_tç»“æ„ï¼Œé‚£å®ƒä¸€å®šä¼šæ‰¾åˆ°å†…æ ¸å ç”¨çš„å†…å­˜é¡µæ‰€å¯¹åº”çš„msadsc_tç»“æ„ï¼Œå¹¶æŠŠè¿™ä¸ªå†…å­˜é¡µåˆ†é…å‡ºå»ï¼Œç„¶åå¾—åˆ°è¿™ä¸ªé¡µé¢çš„ç¨‹åºå¯¹å…¶è¿›è¡Œæ”¹å†™ã€‚è¿™æ ·å†…æ ¸æ•°æ®å°±ä¼šè¢«è¦†ç›–ï¼Œè¿™ç§æƒ…å†µæ˜¯æˆ‘ä»¬ç»å¯¹ä¸èƒ½å…è®¸çš„ã€‚</strong></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æŠŠè¿™äº›å·²ç»å ç”¨çš„å†…å­˜é¡µé¢æ‰€å¯¹åº”çš„msadsc_tç»“æ„æ ‡è®°å‡ºæ¥ï¼Œæ ‡è®°æˆ<strong>å·²åˆ†é…</strong>ï¼Œè¿™æ ·å†…å­˜åˆ†é…ç®—æ³•å°±ä¸ä¼šæ‰¾åˆ°å®ƒä»¬äº†ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªè¦ç»™å‡ºè¢«å ç”¨å†…å­˜çš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼Œç„¶åä»èµ·å§‹åœ°å€å¼€å§‹æŸ¥æ‰¾å¯¹åº”çš„msadsc_tç»“æ„ï¼Œå†æŠŠå®ƒæ ‡è®°ä¸ºå·²ç»åˆ†é…ï¼Œæœ€åç›´åˆ°æŸ¥æ‰¾åˆ°ç»“æŸåœ°å€ä¸ºæ­¢ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬åœ¨msadsc.cæ–‡ä»¶ä¸­æ¥å®ç°è¿™ä¸ªæ–¹æ¡ˆï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code>//æœç´¢ä¸€æ®µå†…å­˜åœ°å€ç©ºé—´æ‰€å¯¹åº”çš„msadsc_tç»“æ„
u64_t search_segment_occupymsadsc(msadsc_t *msastart, u64_t msanr, u64_t ocpystat, u64_t ocpyend)
{
    u64_t mphyadr = 0, fsmsnr = 0;
    msadsc_t *fstatmp = NULL;
    for (u64_t mnr = 0; mnr &lt; msanr; mnr++)
    {
        if ((msastart[mnr].md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE) == ocpystat)
        {
            //æ‰¾å‡ºå¼€å§‹åœ°å€å¯¹åº”çš„ç¬¬ä¸€ä¸ªmsadsc_tç»“æ„ï¼Œå°±è·³è½¬åˆ°step1
            fstatmp = &amp;msastart[mnr];
            goto step1;
        }
    }
step1:
    fsmsnr = 0;
    if (NULL == fstatmp)
    {
        return 0;
    }
    for (u64_t tmpadr = ocpystat; tmpadr &lt; ocpyend; tmpadr += PAGESIZE, fsmsnr++)
    {
        //ä»å¼€å§‹åœ°å€å¯¹åº”çš„ç¬¬ä¸€ä¸ªmsadsc_tç»“æ„å¼€å§‹è®¾ç½®ï¼Œç›´åˆ°ç»“æŸåœ°å€å¯¹åº”çš„æœ€åä¸€ä¸ªmasdsc_tç»“æ„
        mphyadr = fstatmp[fsmsnr].md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE;
        if (mphyadr != tmpadr)
        {
            return 0;
        }
        if (MF_MOCTY_FREE != fstatmp[fsmsnr].md_indxflgs.mf_mocty ||
            0 != fstatmp[fsmsnr].md_indxflgs.mf_uindx ||
            PAF_NO_ALLOC != fstatmp[fsmsnr].md_phyadrs.paf_alloc)
        {
            return 0;
        }
        //è®¾ç½®msadsc_tç»“æ„ä¸ºå·²ç»åˆ†é…ï¼Œå·²ç»åˆ†é…ç»™å†…æ ¸
        fstatmp[fsmsnr].md_indxflgs.mf_mocty = MF_MOCTY_KRNL;
        fstatmp[fsmsnr].md_indxflgs.mf_uindx++;
        fstatmp[fsmsnr].md_phyadrs.paf_alloc = PAF_ALLOC;
    }
    //è¿›è¡Œä¸€äº›æ•°æ®çš„æ­£ç¡®æ€§æ£€æŸ¥
    u64_t ocpysz = ocpyend - ocpystat;
    if ((ocpysz &amp; 0xfff) != 0)
    {
        if (((ocpysz &gt;&gt; PSHRSIZE) + 1) != fsmsnr)
        {
            return 0;
        }
        return fsmsnr;
    }
    if ((ocpysz &gt;&gt; PSHRSIZE) != fsmsnr)
    {
        return 0;
    }
    return fsmsnr;
}


bool_t search_krloccupymsadsc_core(machbstart_t *mbsp)
{
    u64_t retschmnr = 0;
    msadsc_t *msadstat = (msadsc_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_memmappadr);
    u64_t msanr = mbsp-&gt;mb_memmapnr;
    //æœç´¢BIOSä¸­æ–­è¡¨å ç”¨çš„å†…å­˜é¡µæ‰€å¯¹åº”msadsc_tç»“æ„
    retschmnr = search_segment_occupymsadsc(msadstat, msanr, 0, 0x1000);
    if (0 == retschmnr)
    {
        return FALSE;
    }
    //æœç´¢å†…æ ¸æ ˆå ç”¨çš„å†…å­˜é¡µæ‰€å¯¹åº”msadsc_tç»“æ„
    retschmnr = search_segment_occupymsadsc(msadstat, msanr, mbsp-&gt;mb_krlinitstack &amp; (~(0xfffUL)), mbsp-&gt;mb_krlinitstack);
    if (0 == retschmnr)
    {
        return FALSE;
    }
    //æœç´¢å†…æ ¸å ç”¨çš„å†…å­˜é¡µæ‰€å¯¹åº”msadsc_tç»“æ„
    retschmnr = search_segment_occupymsadsc(msadstat, msanr, mbsp-&gt;mb_krlimgpadr, mbsp-&gt;mb_nextwtpadr);
    if (0 == retschmnr)
    {
        return FALSE;
    }
    //æœç´¢å†…æ ¸æ˜ åƒæ–‡ä»¶å ç”¨çš„å†…å­˜é¡µæ‰€å¯¹åº”msadsc_tç»“æ„
    retschmnr = search_segment_occupymsadsc(msadstat, msanr, mbsp-&gt;mb_imgpadr, mbsp-&gt;mb_imgpadr + mbsp-&gt;mb_imgsz);
    if (0 == retschmnr)
    {
        return FALSE;
    }
    return TRUE;
}
//åˆå§‹åŒ–æœç´¢å†…æ ¸å ç”¨çš„å†…å­˜é¡µé¢
void init_search_krloccupymm(machbstart_t *mbsp)
{
    //å®é™…åˆå§‹åŒ–æœç´¢å†…æ ¸å ç”¨çš„å†…å­˜é¡µé¢
    if (search_krloccupymsadsc_core(mbsp) == FALSE)
    {
        system_error(&quot;search_krloccupymsadsc_core fail\n&quot;);
    }
    return;
}
</code></pre><p>è¿™ä¸‰ä¸ªå‡½æ•°é€»è¾‘å¾ˆç®€å•ï¼Œç”±init_search_krloccupymmå‡½æ•°å…¥å£ï¼Œsearch_krloccupymsadsc_coreå‡½æ•°é©±åŠ¨ï¼Œç”±search_segment_occupymsadscå‡½æ•°å®Œæˆå®é™…çš„å·¥ä½œã€‚</p><p>ç”±äºåˆå§‹åŒ–é˜¶æ®µå„ç§æ•°æ®å ç”¨çš„å¼€å§‹ã€ç»“æŸåœ°å€å’Œå¤§å°ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åœ¨machbstart_tç±»å‹çš„kmachbspå˜é‡ä¸­ï¼Œæ‰€ä»¥å‡½æ•°ä¸machbstart_tç±»å‹çš„æŒ‡é’ˆä¸ºå‚æ•°ã€‚</p><p>å…¶å®phymmarge_tã€msadsc_tã€memarea_tè¿™äº›ç»“æ„çš„å®ä¾‹å˜é‡å’ŒMMUé¡µè¡¨ï¼Œå®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å·²ç»æ¶µç›–åœ¨äº†å†…æ ¸è‡ªèº«å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><p>å¥½äº†ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å·²ç»å®Œç¾è§£å†³ï¼Œåªè¦åœ¨åˆå§‹åŒ–å†…å­˜é¡µç»“æ„å’Œå†…å­˜åŒºç»“æ„ä¹‹åè°ƒç”¨init_search_krloccupymmå‡½æ•°å³å¯ã€‚</p><h3>åˆå¹¶å†…å­˜é¡µåˆ°å†…å­˜åŒº</h3><p>æˆ‘ä»¬åšäº†è¿™ä¹ˆå¤šå‰æœŸå·¥ä½œï¼Œä¾ç„¶æ²¡æœ‰è®©å†…å­˜é¡µå’Œå†…å­˜åŒºè”ç³»èµ·æ¥ï¼Œå³è®©msadsc_tç»“æ„æŒ‚è½½åˆ°å†…å­˜åŒºå¯¹åº”çš„æ•°ç»„ä¸­ã€‚åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½æé«˜å†…å­˜ç®¡ç†å™¨çš„åˆ†é…é€Ÿåº¦ã€‚</p><p>è®©æˆ‘ä»¬æ¥ç€æ‰‹å¹²è¿™ä»¶äº‹æƒ…ï¼Œè¿™ä»¶äº‹æƒ…æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯æˆ‘ç»™ä½ æ¢³ç†ä»¥åå°±ä¼šæ¸…æ™°å¾ˆå¤šã€‚æ•´ä½“ä¸Šå¯ä»¥åˆ†æˆä¸¤æ­¥ã€‚</p><p>1.<strong>ç¡®å®šå†…å­˜é¡µå±äºå“ªä¸ªåŒº</strong>ï¼Œå³æ ‡å®šä¸€ç³»åˆ—msadsc_tç»“æ„æ˜¯å±äºå“ªä¸ªmemarea_tç»“æ„çš„ã€‚<br>
2.<strong>æŠŠç‰¹å®šçš„å†…å­˜é¡µåˆå¹¶</strong>ï¼Œç„¶åæŒ‚è½½åˆ°ç‰¹å®šçš„å†…å­˜åŒºä¸‹çš„memdivmer_tç»“æ„ä¸­çš„dm_mdmlielstæ•°ç»„ä¸­ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥åšç¬¬ä¸€ä»¶äº‹ï¼Œè¿™ä»¶äº‹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬åªè¦éå†æ¯ä¸ªmemarea_tç»“æ„ï¼Œéå†è¿‡ç¨‹ä¸­æ ¹æ®ç‰¹å®šçš„memarea_tç»“æ„ï¼Œç„¶åå»æ‰«ææ•´ä¸ªmsadsc_tç»“æ„æ•°ç»„ï¼Œæœ€åä¾æ¬¡å¯¹æ¯”msadsc_tçš„ç‰©ç†åœ°å€ï¼Œçœ‹å®ƒæ˜¯å¦è½åœ¨memarea_tç»“æ„çš„åœ°å€åŒºé—´ä¸­ã€‚</p><p>å¦‚æœæ˜¯ï¼Œå°±æŠŠè¿™ä¸ªmemarea_tç»“æ„çš„ç±»å‹å€¼å†™å…¥msadsc_tç»“æ„ä¸­ï¼Œè¿™æ ·å°±ä¸€ä¸ªä¸€ä¸ªæ‰“ä¸Šäº†æ ‡ç­¾ï¼Œéå†memarea_tç»“æ„ç»“æŸä¹‹åï¼Œæ¯ä¸ªmsadsc_tç»“æ„å°±åªå½’å±äºæŸä¸€ä¸ªmemarea_tç»“æ„äº†ã€‚</p><p>æˆ‘ä»¬åœ¨memarea.cæ–‡ä»¶ä¸­å†™å‡ ä¸ªå‡½æ•°ï¼Œæ¥å®ç°å‰é¢è¿™ä¸ªæ­¥éª¤ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>//ç»™msadsc_tç»“æ„æ‰“ä¸Šæ ‡ç­¾
uint_t merlove_setallmarflgs_onmemarea(memarea_t *mareap, msadsc_t *mstat, uint_t msanr)
{
    u32_t muindx = 0;
    msadflgs_t *mdfp = NULL;
    //è·å–å†…å­˜åŒºç±»å‹
    switch (mareap-&gt;ma_type){
    case MA_TYPE_HWAD:
        muindx = MF_MARTY_HWD &lt;&lt; 5;//ç¡¬ä»¶åŒºæ ‡ç­¾
        mdfp = (msadflgs_t *)(&amp;muindx);
        break;
    case MA_TYPE_KRNL:
        muindx = MF_MARTY_KRL &lt;&lt; 5;//å†…æ ¸åŒºæ ‡ç­¾
        mdfp = (msadflgs_t *)(&amp;muindx);
        break;
    case MA_TYPE_PROC:
        muindx = MF_MARTY_PRC &lt;&lt; 5;//åº”ç”¨åŒºæ ‡ç­¾
        mdfp = (msadflgs_t *)(&amp;muindx);
        break;
    }
    u64_t phyadr = 0;
    uint_t retnr = 0;
    //æ‰«ææ‰€æœ‰çš„msadsc_tç»“æ„
    for (uint_t mix = 0; mix &lt; msanr; mix++)
    {
        if (MF_MARTY_INIT == mstat[mix].md_indxflgs.mf_marty)
        {    //è·å–msadsc_tç»“æ„å¯¹åº”çš„åœ°å€
            phyadr = mstat[mix].md_phyadrs.paf_padrs &lt;&lt; PSHRSIZE;
            //å’Œå†…å­˜åŒºçš„åœ°å€åŒºé—´æ¯”è¾ƒ 
            if (phyadr &gt;= mareap-&gt;ma_logicstart &amp;&amp; ((phyadr + PAGESIZE) - 1) &lt;= mareap-&gt;ma_logicend)
            {
                //è®¾ç½®msadsc_tç»“æ„çš„æ ‡ç­¾
                mstat[mix].md_indxflgs.mf_marty = mdfp-&gt;mf_marty;
                retnr++;
            }
        }
    }
    return retnr;
}

bool_t merlove_mem_core(machbstart_t *mbsp)
{
    //è·å–msadsc_tç»“æ„çš„é¦–åœ°å€
    msadsc_t *mstatp = (msadsc_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_memmappadr);
    //è·å–msadsc_tç»“æ„çš„ä¸ªæ•°
    uint_t msanr = (uint_t)mbsp-&gt;mb_memmapnr, maxp = 0;
    //è·å–memarea_tç»“æ„çš„é¦–åœ°å€
    memarea_t *marea = (memarea_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_memznpadr);
    uint_t sretf = ~0UL, tretf = ~0UL;
    //éå†æ¯ä¸ªmemarea_tç»“æ„
    for (uint_t mi = 0; mi &lt; (uint_t)mbsp-&gt;mb_memznnr; mi++)
    {
        //é’ˆå¯¹å…¶ä¸­ä¸€ä¸ªmemarea_tç»“æ„ç»™msadsc_tç»“æ„æ‰“ä¸Šæ ‡ç­¾
        sretf = merlove_setallmarflgs_onmemarea(&amp;marea[mi], mstatp, msanr);
        if ((~0UL) == sretf)
        {
            return FALSE;
        }
    }
     //éå†æ¯ä¸ªmemarea_tç»“æ„
    for (uint_t maidx = 0; maidx &lt; (uint_t)mbsp-&gt;mb_memznnr; maidx++)
    {
        //é’ˆå¯¹å…¶ä¸­ä¸€ä¸ªmemarea_tç»“æ„å¯¹msadsc_tç»“æ„è¿›è¡Œåˆå¹¶
        if (merlove_mem_onmemarea(&amp;marea[maidx], mstatp, msanr) == FALSE)
        {
            return FALSE;
        }
        maxp += marea[maidx].ma_maxpages;
    }
    return TRUE;
}
//åˆå§‹åŒ–é¡µé¢åˆå¹¶
void init_merlove_mem()
{
    if (merlove_mem_core(&amp;kmachbsp) == FALSE)
    {
        system_error(&quot;merlove_mem_core fail\n&quot;);
    }
    return;
}
</code></pre><p>æˆ‘ä»¬ä¸€ä¸‹å­å†™äº†ä¸‰ä¸ªå‡½æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸”å¬æˆ‘ä¸€ä¸€é“æ¥ã€‚ä»init_merlove_memå‡½æ•°å¼€å§‹ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å®é™…å¹²æ´»ï¼Œä½œä¸ºå…¥å£å‡½æ•°ï¼Œå®ƒè°ƒç”¨çš„merlove_mem_coreå‡½æ•°æ‰æ˜¯çœŸæ­£å¹²æ´»çš„ã€‚</p><p>è¿™ä¸ªmerlove_mem_coreå‡½æ•°æœ‰ä¸¤ä¸ªéå†å†…å­˜åŒºï¼Œç¬¬ä¸€æ¬¡éå†æ˜¯ä¸ºäº†å®Œæˆä¸Šè¿°ç¬¬ä¸€æ­¥ï¼šç¡®å®šå†…å­˜é¡µå±äºå“ªä¸ªåŒºã€‚</p><p>å½“ç¡®å®šå†…å­˜é¡µå±äºå“ªä¸ªåŒºä¹‹åï¼Œå°±æ¥åˆ°äº†ç¬¬äºŒæ¬¡éå†memarea_tç»“æ„ï¼Œåˆå¹¶å…¶ä¸­çš„msadsc_tç»“æ„ï¼Œå¹¶æŠŠå®ƒä»¬æŒ‚è½½åˆ°å…¶ä¸­çš„memdivmer_tç»“æ„ä¸‹çš„dm_mdmlielstæ•°ç»„ä¸­ã€‚</p><p>è¿™ä¸ªæ“ä½œå°±ç¨å¾®æœ‰ç‚¹å¤æ‚äº†ã€‚<strong>ç¬¬ä¸€ï¼Œå®ƒè¦ä¿è¯å…¶ä¸­æ‰€æœ‰çš„msadsc_tç»“æ„æŒ‚è½½åˆ°dm_mdmlielstæ•°ç»„ä¸­åˆé€‚çš„bafhlst_tç»“æ„ä¸­ã€‚</strong></p><p><strong>ç¬¬äºŒï¼Œå®ƒè¦ä¿è¯å¤šä¸ªmsadsc_tç»“æ„æœ‰æœ€å¤§çš„è¿ç»­æ€§ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä¸€ä¸ªå†…å­˜åŒºä¸­æœ‰12ä¸ªé¡µé¢ï¼Œå…¶ä¸­10ä¸ªé¡µé¢æ˜¯è¿ç»­çš„åœ°å€ä¸º0ï½0x9000ï¼Œè¿˜æœ‰ä¸¤ä¸ªé¡µé¢å…¶ä¸­ä¸€ä¸ªåœ°å€ä¸º0xb000ï¼Œå¦ä¸€ä¸ªåœ°å€ä¸º0xe000ã€‚</p><p>è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å¤šä¸ªé¡µé¢ä¿æŒæœ€å¤§çš„è¿ç»­æ€§ï¼Œè¿˜æœ‰åœ¨m_mdmlielstæ•°ç»„ä¸­æ‰¾åˆ°åˆé€‚çš„bafhlst_tç»“æ„ã€‚</p><p>é‚£ä¹ˆï¼š0ï½0x7000è¿™8ä¸ªé¡µé¢å°±è¦æŒ‚è½½åˆ°m_mdmlielstæ•°ç»„ä¸­ç¬¬3ä¸ªbafhlst_tç»“æ„ä¸­ï¼›0x8000ï½0x9000è¿™2ä¸ªé¡µé¢è¦æŒ‚è½½åˆ°m_mdmlielstæ•°ç»„ä¸­ç¬¬1ä¸ªbafhlst_tç»“æ„ä¸­ï¼Œè€Œ0xb000å’Œ0xe000è¿™2ä¸ªé¡µé¢éƒ½è¦æŒ‚è½½åˆ°m_mdmlielstæ•°ç»„ä¸­ç¬¬0ä¸ªbafhlst_tç»“æ„ä¸­ã€‚</p><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼Œéå†æ¯ä¸ªå†…å­˜åŒºï¼Œç„¶åé’ˆå¯¹å…¶ä¸­æ¯ä¸€ä¸ªå†…å­˜åŒºè¿›è¡Œmsadsc_tç»“æ„çš„åˆå¹¶æ“ä½œï¼Œå®Œæˆè¿™ä¸ªæ“ä½œçš„æ˜¯<strong>merlove_mem_onmemarea</strong>ï¼Œæˆ‘ä»¬è¿™å°±å»å†™å¥½è¿™ä¸ªå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>bool_t continumsadsc_add_bafhlst(memarea_t *mareap, bafhlst_t *bafhp, msadsc_t *fstat, msadsc_t *fend, uint_t fmnr)
{
    fstat-&gt;md_indxflgs.mf_olkty = MF_OLKTY_ODER;
    //å¼€å§‹çš„msadsc_tç»“æ„æŒ‡å‘æœ€åçš„msadsc_tç»“æ„ 
    fstat-&gt;md_odlink = fend;
    fend-&gt;md_indxflgs.mf_olkty = MF_OLKTY_BAFH;
    //æœ€åçš„msadsc_tç»“æ„æŒ‡å‘å®ƒå±äºçš„bafhlst_tç»“æ„ 
    fend-&gt;md_odlink = bafhp;
    //æŠŠå¤šä¸ªåœ°å€è¿ç»­çš„msadsc_tç»“æ„çš„çš„å¼€å§‹çš„é‚£ä¸ªmsadsc_tç»“æ„æŒ‚è½½åˆ°bafhlst_tç»“æ„çš„af_frelstä¸­
    list_add(&amp;fstat-&gt;md_list, &amp;bafhp-&gt;af_frelst);
    //æ›´æ–°bafhlst_tçš„ç»Ÿè®¡æ•°æ®
    bafhp-&gt;af_fobjnr++;
    bafhp-&gt;af_mobjnr++;
    //æ›´æ–°å†…å­˜åŒºçš„ç»Ÿè®¡æ•°æ®
    mareap-&gt;ma_maxpages += fmnr;
    mareap-&gt;ma_freepages += fmnr;
    mareap-&gt;ma_allmsadscnr += fmnr;
    return TRUE;
}

bool_t continumsadsc_mareabafh_core(memarea_t *mareap, msadsc_t **rfstat, msadsc_t **rfend, uint_t *rfmnr)
{
    uint_t retval = *rfmnr, tmpmnr = 0;
    msadsc_t *mstat = *rfstat, *mend = *rfend;
    //æ ¹æ®åœ°å€è¿ç»­çš„msadsc_tç»“æ„çš„æ•°é‡æŸ¥æ‰¾åˆé€‚bafhlst_tç»“æ„
    bafhlst_t *bafhp = find_continumsa_inbafhlst(mareap, retval);
    //åˆ¤æ–­bafhlst_tç»“æ„çŠ¶æ€å’Œç±»å‹å¯¹ä¸å¯¹
    if ((BAFH_STUS_DIVP == bafhp-&gt;af_stus || BAFH_STUS_DIVM == bafhp-&gt;af_stus) &amp;&amp; MA_TYPE_PROC != mareap-&gt;ma_type)
    {
        //çœ‹åœ°å€è¿ç»­çš„msadsc_tç»“æ„çš„æ•°é‡æ˜¯ä¸æ˜¯æ­£å¥½æ˜¯bafhp-&gt;af_oderpnr
        tmpmnr = retval - bafhp-&gt;af_oderpnr;
        //æ ¹æ®åœ°å€è¿ç»­çš„msadsc_tç»“æ„æŒ‚è½½åˆ°bafhlst_tç»“æ„ä¸­
        if (continumsadsc_add_bafhlst(mareap, bafhp, mstat, &amp;mstat[bafhp-&gt;af_oderpnr - 1], bafhp-&gt;af_oderpnr) == FALSE)
        {
            return FALSE;
        }
        //å¦‚æœåœ°å€è¿ç»­çš„msadsc_tç»“æ„çš„æ•°é‡æ­£å¥½æ˜¯bafhp-&gt;af_oderpnråˆ™å®Œæˆï¼Œå¦åˆ™è¿”å›å†æ¬¡è¿›å…¥æ­¤å‡½æ•° 
        if (tmpmnr == 0)
        {
            *rfmnr = tmpmnr;
            *rfend = NULL;
            return TRUE;
        }
        //æŒ‚è½½bafhp-&gt;af_oderpnråœ°å€è¿ç»­çš„msadsc_tç»“æ„åˆ°bafhlst_tä¸­
        *rfstat = &amp;mstat[bafhp-&gt;af_oderpnr];
        //è¿˜å‰©å¤šå°‘ä¸ªåœ°å€è¿ç»­çš„msadsc_tç»“æ„
        *rfmnr = tmpmnr;
        return TRUE;
    }
    return FALSE;
}

bool_t merlove_continumsadsc_mareabafh(memarea_t *mareap, msadsc_t *mstat, msadsc_t *mend, uint_t mnr)
{
    uint_t mnridx = mnr;
    msadsc_t *fstat = mstat, *fend = mend;
    //å¦‚æœmnridx &gt; 0å¹¶ä¸”NULL != fendå°±å¾ªç¯è°ƒç”¨continumsadsc_mareabafh_coreå‡½æ•°ï¼Œè€Œmnridxå’Œfendç”±è¿™ä¸ªå‡½æ•°æ§åˆ¶
    for (; (mnridx &gt; 0 &amp;&amp; NULL != fend);)
    {
    //ä¸ºä¸€æ®µåœ°å€è¿ç»­çš„msadsc_tç»“æ„å¯»æ‰¾åˆé€‚m_mdmlielstæ•°ç»„ä¸­çš„bafhlst_tç»“æ„
        continumsadsc_mareabafh_core(mareap, &amp;fstat, &amp;fend, &amp;mnridx)
    }
    return TRUE;
}


bool_t merlove_scan_continumsadsc(memarea_t *mareap, msadsc_t *fmstat, uint_t *fntmsanr, uint_t fmsanr,
                                         msadsc_t **retmsastatp, msadsc_t **retmsaendp, uint_t *retfmnr)
{
    u32_t muindx = 0;
    msadflgs_t *mdfp = NULL;

    msadsc_t *msastat = fmstat;
    uint_t retfindmnr = 0;
    bool_t rets = FALSE;
    uint_t tmidx = *fntmsanr;
    //ä»å¤–å±‚å‡½æ•°çš„fntmnrå˜é‡å¼€å§‹éå†æ‰€æœ‰msadsc_tç»“æ„
    for (; tmidx &lt; fmsanr; tmidx++)
    {
    //ä¸€ä¸ªmsadsc_tç»“æ„æ˜¯å¦å±äºè¿™ä¸ªå†…å­˜åŒºï¼Œæ˜¯å¦ç©ºé—²
        if (msastat[tmidx].md_indxflgs.mf_marty == mdfp-&gt;mf_marty &amp;&amp;
            0 == msastat[tmidx].md_indxflgs.mf_uindx &amp;&amp;
            MF_MOCTY_FREE == msastat[tmidx].md_indxflgs.mf_mocty &amp;&amp;
            PAF_NO_ALLOC == msastat[tmidx].md_phyadrs.paf_alloc)
        {
        //è¿”å›ä»è¿™ä¸ªmsadsc_tç»“æ„å¼€å§‹åˆ°ä¸‹ä¸€ä¸ªéç©ºé—²ã€åœ°å€éè¿ç»­çš„msadsc_tç»“æ„å¯¹åº”çš„msadsc_tç»“æ„ç´¢å¼•å·åˆ°retfindmnrå˜é‡ä¸­
            rets = scan_len_msadsc(&amp;msastat[tmidx], mdfp, fmsanr, &amp;retfindmnr);
            //ä¸‹ä¸€è½®å¼€å§‹çš„msadsc_tç»“æ„ç´¢å¼•
            *fntmsanr = tmidx + retfindmnr + 1;
            //å½“å‰åœ°å€è¿ç»­msadsc_tç»“æ„çš„å¼€å§‹åœ°å€
            *retmsastatp = &amp;msastat[tmidx];
            //å½“å‰åœ°å€è¿ç»­msadsc_tç»“æ„çš„ç»“æŸåœ°å€
            *retmsaendp = &amp;msastat[tmidx + retfindmnr];
            //å½“å‰æœ‰å¤šå°‘ä¸ªåœ°å€è¿ç»­msadsc_tç»“æ„
            *retfmnr = retfindmnr + 1;
            return TRUE;
        }
    }
    return FALSE;
}

bool_t merlove_mem_onmemarea(memarea_t *mareap, msadsc_t *mstat, uint_t msanr)
{
    msadsc_t *retstatmsap = NULL, *retendmsap = NULL, *fntmsap = mstat;
    uint_t retfindmnr = 0;
    uint_t fntmnr = 0;
    bool_t retscan = FALSE;
    
    for (; fntmnr &lt; msanr;)
    {
        //è·å–æœ€å¤šä¸”åœ°å€è¿ç»­çš„msadsc_tç»“æ„ä½“çš„å¼€å§‹ã€ç»“æŸåœ°å€ã€ä¸€å…±å¤šå°‘ä¸ªmsadsc_tç»“æ„ä½“ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯çš„fntmnr
        retscan = merlove_scan_continumsadsc(mareap, fntmsap, &amp;fntmnr, msanr, &amp;retstatmsap, &amp;retendmsap, &amp;retfindmnr);
        if (NULL != retstatmsap &amp;&amp; NULL != retendmsap)
        {
        //æŠŠä¸€ç»„è¿ç»­çš„msadsc_tç»“æ„ä½“æŒ‚è½½åˆ°åˆé€‚çš„m_mdmlielstæ•°ç»„ä¸­çš„bafhlst_tç»“æ„ä¸­
        merlove_continumsadsc_mareabafh(mareap, retstatmsap, retendmsap, retfindmnr)
        }
    }
    return TRUE;
}
</code></pre><p>ä¸ºäº†èŠ‚çº¦ç¯‡å¹…ï¼Œæˆ‘åˆ é™¤äº†å¤§é‡æ£€æŸ¥é”™è¯¯çš„ä»£ç ï¼Œä½ å¯ä»¥åœ¨æˆ‘æä¾›çš„<a href="https://gitee.com/lmos/cosmos/blob/master/lesson16~18/Cosmos/hal/x86/memarea.c#L694">æºä»£ç </a>é‡Œè‡ªè¡ŒæŸ¥çœ‹ã€‚</p><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæ•´ä½“ä¸Šåˆ†ä¸ºä¸¤æ­¥ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡merlove_scan_continumsadscå‡½æ•°ï¼Œè¿”å›æœ€å¤šä¸”åœ°å€è¿ç»­çš„msadsc_tç»“æ„ä½“çš„å¼€å§‹ã€ç»“æŸåœ°å€ã€ä¸€å…±å¤šå°‘ä¸ªmsadsc_tç»“æ„ä½“ï¼Œä¸‹ä¸€è½®å¼€å§‹çš„msadsc_tç»“æ„ä½“çš„ç´¢å¼•å·ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œæ ¹æ®ç¬¬ä¸€æ­¥è·å–çš„ä¿¡æ¯è°ƒç”¨merlove_continumsadsc_mareabafhå‡½æ•°ï¼ŒæŠŠç¬¬ä¸€æ­¥è¿”å›é‚£ä¸€ç»„è¿ç»­çš„msadsc_tç»“æ„ä½“ï¼ŒæŒ‚è½½åˆ°åˆé€‚çš„m_mdmlielstæ•°ç»„ä¸­çš„bafhlst_tç»“æ„ä¸­ã€‚è¯¦ç»†çš„é€»è¾‘å·²ç»åœ¨æ³¨é‡Šä¸­è¯´æ˜ã€‚</p><p>å¥½ï¼Œå†…å­˜é¡µå·²ç»æŒ‰ç…§è§„å®šçš„æ–¹å¼ç»„ç»‡èµ·æ¥äº†ï¼Œè¿™è¡¨ç¤ºç‰©ç†å†…å­˜ç®¡ç†å™¨çš„åˆå§‹åŒ–å·¥ä½œå·²ç»è¿›å…¥å°¾å£°ã€‚</p><h3>åˆå§‹åŒ–æ±‡æ€»</h3><p>åˆ«æ€¥ï¼å…ˆåˆ«æ€¥ç€å†™å†…å­˜åˆ†é…ç›¸å…³çš„ä»£ç ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€èµ·å†™äº†è¿™ä¹ˆå¤šçš„å†…å­˜åˆå§‹åŒ–ç›¸å…³çš„ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰è°ƒç”¨å®ƒä»¬ã€‚</p><p>æ ¹æ®å‰é¢å†…å­˜ç®¡ç†æ•°æ®ç»“æ„çš„å…³ç³»ï¼Œå¾ˆæ˜¾ç„¶ï¼Œ<strong>å®ƒä»¬çš„è°ƒç”¨æ¬¡åºå¾ˆé‡è¦ï¼Œè°å…ˆè°åéƒ½æœ‰ä¸¥æ ¼çš„è§„å®šï¼Œè¿™å…³ä¹å†…å­˜ç®¡ç†åˆå§‹åŒ–çš„æˆè´¥ã€‚</strong>æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å°±åœ¨å…ˆå‰çš„init_memmgrå‡½æ•°ä¸­å»è°ƒç”¨å®ƒä»¬ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>void init_memmgr()
{
    //åˆå§‹åŒ–å†…å­˜é¡µç»“æ„
    init_msadsc();
    //åˆå§‹åŒ–å†…å­˜åŒºç»“æ„
    init_memarea();
    //å¤„ç†å†…å­˜å ç”¨
    init_search_krloccupymm(&amp;kmachbsp);
    //åˆå¹¶å†…å­˜é¡µåˆ°å†…å­˜åŒºä¸­
    init_merlove_mem();
    init_memmgrob();
    return;
}
</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œinit_msadscã€init_memareaå‡½æ•°æ˜¯å¯ä»¥äº¤æ¢æ¬¡åºçš„ï¼Œå®ƒä»¬ä¿©äº’ä¸å½±å“ï¼Œä½†å®ƒä»¬ä¿©å¿…é¡»æœ€å…ˆå¼€å§‹è°ƒç”¨ï¼Œè€Œåé¢çš„å‡½æ•°è¦ä¾èµ–å®ƒä»¬ç”Ÿæˆçš„æ•°æ®ç»“æ„ã€‚</p><p>ä½†æ˜¯init_search_krloccupymmå‡½æ•°å¿…é¡»è¦åœ¨init_merlove_memå‡½æ•°ä¹‹å‰è¢«è°ƒç”¨ï¼Œå› ä¸ºinit_merlove_memå‡½æ•°åœ¨åˆå¹¶é¡µé¢æ—¶ï¼Œå¿…é¡»å…ˆçŸ¥é“å“ªäº›é¡µé¢è¢«å ç”¨äº†ã€‚</p><p>ç­‰ä¸€ç­‰ï¼Œinit_memmgrobæ˜¯ä»€ä¹ˆå‡½æ•°ï¼Œè¿™ä¸ªæˆ‘ä»¬è¿˜æ²¡å†™å‘¢ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥ç°å®å®ƒã€‚</p><p>ä¸çŸ¥é“ä½ å‘ç°æ²¡æœ‰ï¼Œæˆ‘ä»¬çš„phymmarge_tç»“æ„ä½“çš„åœ°å€å’Œæ•°é‡ã€msadsc_tç»“æ„ä½“çš„åœ°å€å’Œæ•°æ®ã€memarea_tç»“æ„ä½“çš„åœ°å€å’Œæ•°é‡éƒ½ä¿å­˜åœ¨äº†kmachbspå˜é‡ä¸­ï¼Œè¿™ä¸ªå˜é‡å…¶å®ä¸æ˜¯ç”¨æ¥ç®¡ç†å†…å­˜çš„ï¼Œè€Œä¸”å®ƒé‡Œé¢æ”¾çš„æ˜¯<strong>ç‰©ç†åœ°å€</strong>ã€‚</p><p>ä½†å†…æ ¸ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæ¯æ¬¡éƒ½è¦è½¬æ¢æä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªä¸“ç”¨çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå†…å­˜ç®¡ç†ã€‚æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸‹è¿™ä¸ªç»“æ„ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code>//cosmos/include/halinc/halglobal.c
HAL_DEFGLOB_VARIABLE(memmgrob_t,memmgrob);

typedef struct s_MEMMGROB
{
    list_h_t mo_list;
    spinlock_t mo_lock;        //ä¿æŠ¤è‡ªèº«è‡ªæ—‹é”
    uint_t mo_stus;            //çŠ¶æ€
    uint_t mo_flgs;            //æ ‡å¿—
    u64_t mo_memsz;            //å†…å­˜å¤§å°
    u64_t mo_maxpages;         //å†…å­˜æœ€å¤§é¡µé¢æ•°
    u64_t mo_freepages;        //å†…å­˜æœ€å¤§ç©ºé—²é¡µé¢æ•°
    u64_t mo_alocpages;        //å†…å­˜æœ€å¤§åˆ†é…é¡µé¢æ•°
    u64_t mo_resvpages;        //å†…å­˜ä¿ç•™é¡µé¢æ•°
    u64_t mo_horizline;        //å†…å­˜åˆ†é…æ°´ä½çº¿
    phymmarge_t* mo_pmagestat; //å†…å­˜ç©ºé—´å¸ƒå±€ç»“æ„æŒ‡é’ˆ
    u64_t mo_pmagenr;
    msadsc_t* mo_msadscstat;   //å†…å­˜é¡µé¢ç»“æ„æŒ‡é’ˆ
    u64_t mo_msanr;
    memarea_t* mo_mareastat;   //å†…å­˜åŒºç»“æ„æŒ‡é’ˆ 
    u64_t mo_mareanr;
}memmgrob_t;

//cosmos/hal/x86/memmgrinit.c

void memmgrob_t_init(memmgrob_t *initp)
{
    list_init(&amp;initp-&gt;mo_list);
    knl_spinlock_init(&amp;initp-&gt;mo_lock);
    initp-&gt;mo_stus = 0;
    initp-&gt;mo_flgs = 0;
    initp-&gt;mo_memsz = 0;
    initp-&gt;mo_maxpages = 0;
    initp-&gt;mo_freepages = 0;
    initp-&gt;mo_alocpages = 0;
    initp-&gt;mo_resvpages = 0;
    initp-&gt;mo_horizline = 0;
    initp-&gt;mo_pmagestat = NULL;
    initp-&gt;mo_pmagenr = 0;
    initp-&gt;mo_msadscstat = NULL;
    initp-&gt;mo_msanr = 0;
    initp-&gt;mo_mareastat = NULL;
    initp-&gt;mo_mareanr = 0;
    return;
}

void init_memmgrob()
{
    machbstart_t *mbsp = &amp;kmachbsp;
    memmgrob_t *mobp = &amp;memmgrob;
    memmgrob_t_init(mobp);
    mobp-&gt;mo_pmagestat = (phymmarge_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_e820expadr);
    mobp-&gt;mo_pmagenr = mbsp-&gt;mb_e820exnr;
    mobp-&gt;mo_msadscstat = (msadsc_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_memmappadr);
    mobp-&gt;mo_msanr = mbsp-&gt;mb_memmapnr;
    mobp-&gt;mo_mareastat = (memarea_t *)phyadr_to_viradr((adr_t)mbsp-&gt;mb_memznpadr);
    mobp-&gt;mo_mareanr = mbsp-&gt;mb_memznnr;
    mobp-&gt;mo_memsz = mbsp-&gt;mb_memmapnr &lt;&lt; PSHRSIZE;
    mobp-&gt;mo_maxpages = mbsp-&gt;mb_memmapnr;
    uint_t aidx = 0;
    for (uint_t i = 0; i &lt; mobp-&gt;mo_msanr; i++)
    {
        if (1 == mobp-&gt;mo_msadscstat[i].md_indxflgs.mf_uindx &amp;&amp;
            MF_MOCTY_KRNL == mobp-&gt;mo_msadscstat[i].md_indxflgs.mf_mocty &amp;&amp;
            PAF_ALLOC == mobp-&gt;mo_msadscstat[i].md_phyadrs.paf_alloc)
        {
            aidx++;
        }
    }
    mobp-&gt;mo_alocpages = aidx;
    mobp-&gt;mo_freepages = mobp-&gt;mo_maxpages - mobp-&gt;mo_alocpages;
    return;
}
</code></pre><p>è¿™äº›ä»£ç éå¸¸å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬å°±ä¸å†è®¨è®ºäº†ï¼Œæ— éæ˜¯å°†å†…å­˜ç®¡ç†æ ¸å¿ƒæ•°æ®ç»“æ„çš„åœ°å€å’Œæ•°é‡æ”¾åœ¨å…¶ä¸­ï¼Œå¹¶è®¡ç®—äº†ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™æ²¡æœ‰ä»»ä½•éš¾åº¦ï¼Œç›¸ä¿¡ä½ ä¼šè½»æ¾ç†è§£ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©è¯¾ç¨‹çš„é‡ç‚¹å·¥ä½œæ˜¯åˆå§‹åŒ–æˆ‘ä»¬è®¾è®¡çš„å†…å­˜ç®¡ç†æ•°æ®ç»“æ„ï¼Œåœ¨å†…å­˜ä¸­å»ºç«‹å®ƒä»¬çš„å®ä¾‹å˜é‡ï¼Œæˆ‘æ¥ä¸ºä½ æ¢³ç†ä¸€ä¸‹é‡ç‚¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»åˆå§‹åŒ–msadsc_tç»“æ„å¼€å§‹ï¼Œåœ¨å†…å­˜ä¸­å»ºç«‹msadsc_tç»“æ„çš„å®ä¾‹å˜é‡ï¼Œæ¯ä¸ªç‰©ç†å†…å­˜é¡µé¢ä¸€ä¸ªmsadsc_tç»“æ„çš„å®ä¾‹å˜é‡ã€‚</p><p>ç„¶åæ˜¯åˆå§‹åŒ–memarea_tç»“æ„ï¼Œåœ¨msadsc_tç»“æ„çš„å®ä¾‹å˜é‡ä¹‹åï¼Œæ¯ä¸ªå†…å­˜åŒºä¸€ä¸ªmemarea_tç»“æ„å®ä¾‹å˜é‡ã€‚</p><p>æ¥ç€æ ‡è®°å“ªäº›msadsc_tç»“æ„å¯¹åº”çš„ç‰©ç†å†…å­˜è¢«å†…æ ¸å ç”¨äº†ï¼Œè¿™äº›è¢«æ ‡è®°msadsc_tç»“æ„æ˜¯ä¸èƒ½çº³å…¥å†…å­˜ç®¡ç†ç»“æ„ä¸­å»çš„ã€‚</p><p>æœ€åï¼ŒæŠŠæ‰€æœ‰çš„ç©ºé—²msadsc_tç»“æ„æŒ‰æœ€å¤§åœ°å€è¿ç»­çš„å½¢å¼ç»„ç»‡èµ·æ¥ï¼ŒæŒ‚è½½åˆ°memarea_tç»“æ„ä¸‹çš„memdivmer_tç»“æ„ä¸­ï¼Œå¯¹åº”çš„dm_mdmlielstæ•°ç»„ä¸­ã€‚</p><p>ä¸çŸ¥é“ä½ æ˜¯å¦æƒ³è¿‡ï¼Œéšç€ç‰©ç†å†…å­˜ä¸æ–­å¢åŠ ï¼Œmsadsc_tç»“æ„å®ä¾‹å˜é‡æœ¬èº«å ç”¨çš„å†…å­˜ç©ºé—´å°±ä¼šå¢åŠ ï¼Œé‚£ä½ æœ‰åŠæ³•é™ä½msadsc_tç»“æ„å®ä¾‹å˜é‡å ç”¨çš„å†…å­˜ç©ºé—´å—ï¼ŸæœŸå¾…ä½ çš„å®ç°ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·é—®åœ¨4GBçš„ç‰©ç†å†…å­˜çš„æƒ…å†µä¸‹ï¼Œmsadsc_tç»“æ„å®ä¾‹å˜é‡æœ¬èº«å ç”¨å¤šå¤§çš„å†…å­˜ç©ºé—´ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè·Ÿæˆ‘äº¤æµäº’åŠ¨ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚</p><p>å¥½ï¼Œæˆ‘æ˜¯LMOSï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>neohope</span>
  </div>
  <div class="_2_QraFYR_0">ä¸€ã€ç¨å¾®æ•´ç†äº†ä¸€ä¸‹æµç¨‹ï¼š<br>init_hal-&gt;init_halmm-&gt;init_memmgr<br>&#47;&#47;æ¯ä¸ªé¡µå¯¹åº”ä¸€ä¸ªmsadsc_t ç»“æ„ä½“ï¼Œå¾ªç¯å¡«å……msadsc_t ç»“æ„ä½“æ•°ç»„<br>-&gt;init_msadsc<br>&#47;&#47;åˆå§‹åŒ–ä¸‰ç±»memarea_tï¼Œç¡¬ä»¶åŒºã€å†…æ ¸åŒºã€ç”¨æˆ·åŒº<br>-&gt;init_memarea<br>&#47;&#47;å¯¹å·²ä½¿ç”¨çš„é¡µæ‰“ä¸Šæ ‡è®°ï¼ŒåŒ…æ‹¬ï¼šBIOSä¸­æ–­è¡¨ã€å†…æ ¸æ ˆã€å†…æ ¸ã€å†…æ ¸æ˜ åƒ<br>-&gt;init_search_krloccupymm(&amp;kmachbsp);    <br>&#47;&#47;å°†é¡µé¢æŒ‰åœ°å€èŒƒå›´ï¼Œåˆ†é…ç»™å†…å­˜åŒº<br>&#47;&#47;ç„¶åæŒ‰é¡ºåºä¾æ¬¡æŸ¥æ‰¾æœ€é•¿è¿ç»­çš„é¡µé¢ï¼Œæ ¹æ®è¿ç»­é¡µé¢çš„é•¿åº¦ï¼Œ<br>&#47;&#47;å°†è¿™äº›é¡µé¢çš„msadsc_tæŒ‚è½½åˆ°memdivmer_t ç»“æ„ä¸‹çš„bafhlst_tæ•°ç»„dm_mdmlielstä¸­<br>-&gt;init_merlove_mem();<br>&#47;&#47;ç‰©ç†åœ°å€è½¬ä¸ºè™šæ‹Ÿåœ°å€ï¼Œä¾¿äºä»¥åä½¿ç”¨<br>-&gt;init_memmgrob();<br><br>äºŒã€å¯¹äºæœ€åçš„é—®é¢˜ï¼Œç”¨äº†è™šæ‹Ÿæœºè¿›è¡Œæµ‹è¯•ï¼Œä½†æ— è®ºå†…å­˜å¤§å°ï¼Œæ€»æœ‰56Kå†…å­˜æ²¡èƒ½æ‰¾åˆ°ã€æœ‰çŸ¥é“çš„å°ä¼™ä¼´ï¼Œéº»çƒ¦å¸®å¿™è§£ç­”ä¸€ä¸‹ã€‘ï¼š<br>1ã€4Gå†…å­˜æƒ…å†µå¦‚ä¸‹ï¼š<br>ç†è®ºå†…å­˜ï¼š0x1 0000 0000 = 4,194,304K<br>å¯ç”¨å†…å­˜ï¼š0xfff8fc00 = 4,193,855K<br>é¢„ç•™åŒºåŸŸï¼š0x52400  = 329K<br>ç¡¬ä»¶ä½¿ç”¨ï¼š0x10000  = 64K<br>æ²¡èƒ½æ‰¾åˆ°ï¼š0xE000 = 56K<br><br>msadsc_tç»“æ„ä½“å¤§å°ä¸º40ï¼Œä½¿ç”¨å†…å­˜æ€»è®¡ä¸ºï¼š<br>4,193,855K&#47;4K*40=41,938,520=æ¥è¿‘40M<br><br>2ã€2Gå†…å­˜æƒ…å†µå¦‚ä¸‹<br>ç†è®ºå†…å­˜ï¼š0x8000 0000 =2,097,152K<br>å¯ç”¨å†…å­˜ï¼š0x7ff8fc00 = 2,096,703K<br>é¢„ç•™åŒºåŸŸï¼š0x52400  = 329K<br>ç¡¬ä»¶ä½¿ç”¨ï¼š0x10000  = 64K<br>æ²¡èƒ½æ‰¾åˆ°ï¼š0xE000 = 56K<br><br>msadsc_tç»“æ„ä½“å¤§å°ä¸º40ï¼Œä½¿ç”¨å†…å­˜æ€»è®¡ä¸ºï¼š<br>2,096,703K&#47;4K*40=20,967,030=æ¥è¿‘20M<br><br>3ã€1Gå†…å­˜æƒ…å†µå¦‚ä¸‹<br>ç†è®ºå†…å­˜ï¼š0x4000 0000= 1,048,576K<br>å¯ç”¨å†…å­˜ï¼š0x3ff8fc00 = 1,048,127K<br>é¢„ç•™åŒºåŸŸï¼š0x52400  = 329K<br>ç¡¬ä»¶ä½¿ç”¨ï¼š0x10000  = 64K<br>æ²¡èƒ½æ‰¾åˆ°ï¼š0xE000 = 56K<br><br>msadsc_tç»“æ„ä½“å¤§å°ä¸º40ï¼Œä½¿ç”¨å†…å­˜æ€»è®¡ä¸ºï¼š<br>1,048,127K&#47;4K*40=10,481,270=æ¥è¿‘10M<br><br>ä¸‰ã€å¦‚æœæƒ³èŠ‚çº¦msadsc_tå†…å­˜çš„è¯ï¼Œæ„Ÿè§‰æœ‰å‡ ç§æ–¹æ¡ˆï¼š<br>1ã€æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯å¤§å†…å­˜æ—¶é‡‡ç”¨æ›´å¤§çš„åˆ†é¡µï¼Œä½†åº”ç”¨åœ¨ç”³è¯·å†…å­˜æ—¶ï¼ŒåŒæ ·ä¼šæœ‰æ›´å¤šå†…å­˜æµªè´¹<br>2ã€ä¹Ÿå¯ä»¥ç”¨æ›´å¤æ‚çš„é¡µé¢ç®¡ç†æœºåˆ¶ï¼Œæ¯”å¦‚ç›¸åŒå±æ€§çš„è¿ç»­é¡µé¢ä¸è¦ç”¨å¤šä¸ªå•ç‹¬msadsc_tè¡¨ç¤ºï¼Œè€Œç”¨ä¸€ä¸ªmsadsc_tè¡¨ç¤ºå¹¶æ ‡æ˜å…¶èŒƒå›´ï¼Œå¹¶é€šè¿‡skiplistç­‰æ•°æ®ç»“æ„åŠ é€ŸæŸ¥è¯¢ã€‚ä½†æ— è®ºæ˜¯ç”³è¯·å†…å­˜è¿˜æ˜¯å½’è¿˜å†…å­˜æ—¶ï¼Œæ€§èƒ½ä¼šæœ‰æ‰€ä¸‹é™ï¼Œæ„Ÿè§‰å¾—ä¸å¿å¤±ã€‚<br>3ã€é¡µé¢åˆ†ç»„æƒ…å†µè¾ƒå°‘çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ¯ä¸ªç»„å»ºç«‹ä¸€ä¸ªé“¾è¡¨è®°å½•å“ªäº›é¡µé¢å±äºæŸä¸ªé“¾è¡¨ï¼Œè€Œmsadsc_tä¸­åªè®°å½•åœ°å€ç­‰å°‘é‡ä¿¡æ¯ï¼Œä¸é€‚åˆå¤æ‚ç³»ç»Ÿã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¤§ç¥ 6666</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-06-17 01:42:43</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é»„å…‰å</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œæˆ‘è§‰å¾—è¿™ä¸ªç±»ã€å˜é‡çš„å‘½åå¯è¯»æ€§ï¼Œè¿˜æ˜¯éå¸¸éå¸¸é‡è¦çš„<br>è¿™ä¸ªé¡¹ç›®æ˜¯æ‚¨æ‰‹å†™çš„ï¼Œæ¯ä¸€ä¸ªå‘½åä»€ä¹ˆæ„æ€ï¼Œä½ äº†ç„¶äºèƒ¸<br>ä½†æ˜¯æˆ‘ä»¬éƒ½æ˜¯æ–°æ‰‹ï¼Œå¾ˆå¤šå˜é‡å‘½åçœŸçš„å¤ªç®€ç•¥äº†ï¼Œæœ‰å¾ˆå¤šå‘½åå°±ç®—ç¢ç£¨ä¹Ÿä¸ä¸€å®šèƒ½çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€ã€‚<br>çœŸå¿ƒå»ºè®®å‘½åå¯è¯»æ€§è¿˜æ˜¯è¦å¢å¼ºä¸€ä¸‹å“ˆ~~</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¥½çš„ </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-09-02 18:42:33</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>pedro</span>
  </div>
  <div class="_2_QraFYR_0">èƒ¡ä¹±ä¸€çŒœ~<br><br>msadsc_t  å ç”¨å†…å­˜ = 4GB&#47;4KB(é¡µå¤§å°) * sizeof(msadsc_t )</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-06-16 10:43:55</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æµ®ç”Ÿå°½æ­‡</span>
  </div>
  <div class="_2_QraFYR_0">æ€ä¹ˆè°ƒè¯•å†…æ ¸å‘¢ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: KPrint</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-11-14 20:46:09</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ¨å†›</span>
  </div>
  <div class="_2_QraFYR_0">è¿™ä¸€è®²çš„å†…å®¹ã€æ¦‚å¿µå¾ˆå¤šï¼Œå°¤å…¶æ˜¯å†…å­˜é¡µåˆå¹¶åˆ°å†…å­˜åŒºçš„ä»£ç ä¸å¥½ç†è§£ï¼Œå»ºè®®å¤§å®¶æŠŠ16è®²çš„å†…å­˜é¡µé¢ç»„ç»‡ç»“æ„å›¾æ”¾åœ¨æ‰‹è¾¹ï¼Œå¯¹ç…§ä»£ç å¤šçœ‹å‡ æ¬¡æ…¢æ…¢å°±æœ‰æ„Ÿè§‰äº†ï¼ŒåŠ æ²¹ï¼Œè¿‡äº†å†…å­˜ç®¡ç†è¿™é“åï¼Œå°±çœ‹è§èƒœåˆ©çš„æ›™å…‰äº†</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å“ˆå“ˆ </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-09-19 15:03:27</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_a5edac</span>
  </div>
  <div class="_2_QraFYR_0">ä»£ç çš„å‘½åï¼Œä¸å¤ªå¥½æ‡‚ï¼Œèƒ½è¯´ä¸‹å‘½åè§„åˆ™ä¹ˆï¼Œä¸€äº›çœ‹å¾ˆä¹…æ‰çŸ¥é“æ˜¯å“ªäº›ç¼©å†™</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸éœ€è¦ææ‡‚çš„ï¼Œä¸è¦é™·å…¥åè¯æ¦‚å¿µä¹‹ä¸­</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-07-24 03:55:24</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æäºŒç‹—</span>
  </div>
  <div class="_2_QraFYR_0">å¤§å®¶éƒ½èƒ½çœ‹æ‡‚ä»£ç ?</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä»£ç éš¾åº¦æœ‰ç‚¹ç‚¹å¤§</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-02-14 12:41:29</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ç§‹å®‡é›¨</span>
  </div>
  <div class="_2_QraFYR_0">u1s1ï¼Œä»£ç å‘½åçœŸå¿ƒçœ‹æ™•äº†</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ç¼–è¾‘å›å¤: æ”»ç•¥ï¼šå…³æ³¨ä¸‹è¿™äº›ä»£ç è¦å®ç°çš„åŠŸèƒ½æ˜¯å•¥ã€‚è¿˜æ˜¯æ­»ç£•ä¸å‡ºæ¥çš„å±•å¼€è¯´è¯´ï¼Œå¤§å®¶ä¸€èµ·è®¨è®ºè§£å†³ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-01-28 16:10:19</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä»»å›½å®</span>
  </div>
  <div class="_2_QraFYR_0">hiï¼Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œåœ¨å¯åŠ¨åˆå§‹åŒ–çš„æ—¶å€™mmuè®¾ç½®çš„æ¯é¡µ2MBå¤§å°ï¼Œåˆ°å†…æ ¸æ€ä¹ˆå˜æˆ4KBäº†ï¼Œè€Œä¸”çœ‹æºç é‡Œcopy é¡µè¡¨æ•°æ®çš„ä»£ç ä¹Ÿæ˜¯2MB</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¯åŠ¨åˆå§‹åŒ–ç”¨2MBé¡µæ˜¯ä¸ºäº†ç®€åŒ–å¼€å‘</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-01-26 17:44:38</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>PAWCOOK</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®BIOSä¸­æ–­è¡¨å ç”¨çš„å†…å­˜æœ‰å¿…è¦å¤„ç†å—ï¼Ÿæˆ‘ä»¬ä¸æ˜¯å·²ç»è®¾ç½®å¥½äº†è‡ªå·±çš„ä¸­æ–­é—¨æè¿°ç¬¦å—ï¼Ÿè€Œä¸”ï¼Œåªå¤„ç†BIOSä¸­æ–­è¡¨å ç”¨çš„ç©ºé—´æœ‰ä»€ä¹ˆç”¨å‘¢ï¼ŒBIOSä¸­æ–­æœåŠ¡ç¨‹åºä¸ä¹Ÿå ç”¨äº†å†…å­˜å—</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¦å¤„ç† å› ä¸ºåæœŸè¦æœ‰ç”¨çš„</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-11-29 20:42:06</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>PAWCOOK</span>
  </div>
  <div class="_2_QraFYR_0">kmachbsp å˜é‡çš„åœ°å€æ˜¯è™šæ‹Ÿåœ°å€è¡¨ç¤ºçš„ï¼ˆå› ä¸ºå®ƒæ˜¯é•¿æ¨¡å¼ä¸‹çš„å…¨å±€å˜é‡ï¼‰ï¼Œè€Œå…¶ä¸­ä¿å­˜çš„ä¿¡æ¯å´æ˜¯ç‰©ç†åœ°å€ã€‚è¯·é—®è¿™æ ·ç†è§£æ˜¯å¯¹çš„å—ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å—¯å—¯  æœ‰çš„æ˜¯ç‰©ç†åœ°å€ è€Œæœ‰äº›ä¸æ˜¯</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-11-29 17:28:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ç¥ç€Â·</span>
  </div>
  <div class="_2_QraFYR_0">æ‰«æ phymmarge_t ç»“æ„ä½“æ•°ç»„ä¸­çš„ä¿¡æ¯ï¼Œåªè¦å®ƒçš„ç±»å‹æ˜¯å¯ç”¨å†…å­˜ï¼Œå°±å»ºç«‹ä¸€ä¸ª msadsc_t ç»“æ„ä½“ï¼Œå¹¶æŠŠå…¶ä¸­çš„å¼€å§‹åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªé¡µé¢åœ°å€ã€‚<br><br>è¿™é‡Œå·²ç»æŠŠå…¶ä¸­çš„å¼€å§‹åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªé¡µé¢åœ°å€ï¼Œé‚£msadsc_tè¿™ä¸ªç»“æ„ä½“å­˜æ”¾åœ¨å“ªé‡Œå‘¢ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ”¾åœ¨å†…æ ¸åé¢ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å®šäº† </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-11-24 10:49:10</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æœ±ç‚œæ•</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œåˆå§‹åŒ–è¿™äº›æ•°æ®ç»“æ„çš„è¿‡ç¨‹è·Ÿè¡Œä¸ºï¼Œè®©æˆ‘æƒ³åˆ°äº†è‡ªå·±åœ¨ç”µè„‘ä¸Šè£…ä¸Š4Gå†…å­˜æ¡åï¼Œä¸Šç”µåå‘ç°ç³»ç»Ÿåé¦ˆçš„å¯ç”¨å†…å­˜ä¸€èˆ¬åªæœ‰3.8Gå·¦å³ã€‚<br>æ˜¯ä¸æ˜¯ç±»ä¼¼çš„ï¼Œæ¶ˆå¤±çš„å‡ ç™¾å…†å†…å­˜é‡Œï¼Œå­˜æ”¾çš„å°±æ˜¯è¿™äº›é¡µç®¡ç†çš„æ•°æ®ç»“æ„ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿˜æœ‰å†…æ ¸ çš„å…¶å®ƒæ•°æ®   ä½†32ä½ä¸‹ åªèƒ½ä½¿ç”¨2.8GB</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-11-04 10:36:40</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_260041</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆè¯·é—®ï¼Œåˆå¹¶å†…å­˜é¡µåˆ°å†…å­˜åŒºè¿™é‡Œï¼Œuint_t merlove_setallmarflgs_onmemarea(memarea_t *mareap, msadsc_t *mstat, uint_t msanr)è¿™ä¸ªå‡½æ•°é‡Œï¼Œåœ¨æœ€åforå¾ªç¯æ—¶ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨é¡µä¿¡æ¯ç»“æ„(msadsc_t)é‡Œåˆ†é…çš„ç‰©ç†åœ°å€å»å’ŒæŸä¸ªåŒºæ®µé€»è¾‘åœ°å€å»æ¯”è¾ƒå•Šï¼Œè¿™æ ·ç¬¬ä¸€ä¸ªåŒº(ç¡¬ä»¶åŒº)è¿˜å¯ä»¥æ­£å¸¸åˆ†é…ï¼Œç¬¬äºŒä¸ªåŒº(å†…æ ¸åŒº)å°±ç›´æ¥ä¼šæŠŠæ‰€æœ‰é¡µéƒ½åˆ†é…åˆ°å†…æ ¸åŒºäº†å§ï¼Œç¬¬ä¸‰ä¸ªåŒºå°±å®Œå…¨åˆ†é…ä¸åˆ°ä¸€ä¸ªé¡µäº†</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä»£ç æ˜¯è¿™æ ·çš„é€»è¾‘ ç¬¬ä¸‰ä¸ªåŒºåˆ†é…ä¸åˆ° å°±ä¼šåˆ°ç¬¬äºŒä¸ªåŒºã€‚ã€‚ã€‚ </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-10-29 23:41:58</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è¢å¸…</span>
  </div>
  <div class="_2_QraFYR_0">ä¸€ç‚¹ä¹Ÿçœ‹ä¸æ‡‚å•ŠğŸ˜ª</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ç¼–è¾‘å›å¤: å†…å­˜è¿™éƒ¨åˆ†æ¯”è¾ƒéš¾ï¼Œæœ‰ä»€ä¹ˆåœ°æ–¹ä¸æ‡‚å¯ä»¥å…·ä½“æé—®çš„ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-10-20 13:34:04</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ²ˆç•…</span>
  </div>
  <div class="_2_QraFYR_0">æ¯ä¸ªåˆ†åŒºéƒ½è¦éå†ä¸€æ¬¡æ‰€æœ‰çš„é¡µé¢ç»“æ„æ˜¯ä¸æ˜¯æœ‰ç‚¹ä¸åˆç†ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å½“ç„¶æœ‰æ›´é«˜æ•ˆçš„æ–¹æ³• åªæ˜¯è¿™å¾ˆç®€å•</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-09-06 17:31:33</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é»„å…‰å</span>
  </div>
  <div class="_2_QraFYR_0">å¯¹äºâ€œé™ä½ msadsc_t ç»“æ„å®ä¾‹å˜é‡å ç”¨çš„å†…å­˜ç©ºé—´â€ï¼ŒLinuxçš„åšæ³•æ˜¯å¤šçº§åˆ†é¡µï¼Œå¹¶ä¸”â€œæ‡’åŠ è½½â€ç”¨åˆ°æ—¶æ‰ç”Ÿæˆ msadsc_tå®ä¾‹</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: Linuxå¯¹äºPageç»“æ„çš„å¤„ç†å¹¶ä¸æ˜¯</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-09-02 18:45:48</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_a05da2</span>
  </div>
  <div class="_2_QraFYR_0">åŠ è½½  hd.img æ˜¾ç¤º  virtualbox è¯·æä¾›æ—¥å¿—æ–‡ä»¶ VBox.logå’Œå›¾åƒæ–‡ä»¶ VBox.png.è¯·é—®ä¸‹è§£å†³æ–¹æ¡ˆï¼Œè°¢è°¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸èƒ½ç›´æ¥åŠ è½½hd.img è¦æŠŠè¿™ä¸ªè½¬æ¢æˆhd.vdi</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-08-11 16:52:15</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Feen</span>
  </div>
  <div class="_2_QraFYR_0">åŸºæœ¬çš„æ¯”ä¾‹å°±æ˜¯æ¯1GBè¦å ç”¨10Mçš„ç©ºé—´ï¼Œè¿˜å¥½ä¸ç®—å¤ªå¤§ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-07-09 18:32:51</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0">
  
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ï¼null</span>
  </div>
  <div class="_2_QraFYR_0">æ¥ç€ï¼Œè¦ç»™è¿™ä¸ªå¼€å§‹åœ°å€åŠ ä¸Š 0x1000ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°å…¶ç»“æŸåœ°å€ã€‚<br>+0x1000æ˜¯å•¥ä½œç”¨ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸€ä¸ªé¡µé¢å¤§å° å•Š </p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-07-09 08:25:35</div>
  </div>
</div>
</div>
</li>
</ul>